(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[777],{4794:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/test-db",function(){return s(3502)}])},5981:function(e,t,s){"use strict";s.d(t,{Y:function(){return r}});let n=(0,s(1608).eI)("https://crnfwlpcxrnqfgwqnmun.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNybmZ3bHBjeHJucWZnd3FubXVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNTAzMDQsImV4cCI6MjA3MDcyNjMwNH0.g_HmFQQiuGW2TZRzZ5gqCj098DZy6iwn_xQAE6kEUEI"),r={supabase:n,async insert(e,t){let{data:s,error:r}=await n.from(e).insert(t).select();if(r)throw console.error("插入数据错误:",r),r;return s},async select(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=n.from(e).select("*");Object.entries(t).forEach(e=>{let[t,n]=e;s=s.eq(t,n)});let{data:r,error:a}=await s;if(a)throw console.error("查询数据错误:",a),a;return r},async update(e,t,s){let{data:r,error:a}=await n.from(e).update(s).eq("id",t).select();if(a)throw console.error("更新数据错误:",a),a;return r},async delete(e,t){let{error:s}=await n.from(e).delete().eq("id",t);if(s)throw console.error("删除数据错误:",s),s;return!0},async testConnection(){try{let{data:e,error:t}=await n.rpc("version");if(t){let{error:e}=await n.from("test_connection_table").select("*").limit(1);if(e&&("PGRST116"===e.code||"42P01"===e.code))return console.log("数据库连接成功!"),!0;return console.error("数据库连接测试失败:",e||t),!1}return console.log("数据库连接成功!"),!0}catch(e){return console.error("连接测试异常:",e),!1}}}},3502:function(e,t,s){"use strict";s.r(t);var n=s(5893),r=s(7294),a=s(5981),i=s(8339),o=s.n(i);t.default=()=>{let[e,t]=(0,r.useState)("测试中..."),[s,i]=(0,r.useState)([]),[c,l]=(0,r.useState)(!1),_=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];i(s=>[...s,{message:e,success:t,time:new Date().toLocaleTimeString()}])},d=async()=>{l(!0),i([]);try{if(_("开始测试数据库连接..."),await a.Y.testConnection())_("✅ 数据库连接成功"),t("已连接");else{_("❌ 数据库连接失败",!1),t("连接失败");return}_("测试插入数据...");let e={question:"这是一个测试问题",answer:"这是一个测试回答",created_at:new Date().toISOString()};try{await a.Y.insert("conversations",e),_("✅ 数据插入成功"),_("测试查询数据...");let t=await a.Y.select("conversations",{question:"这是一个测试问题"});t&&t.length>0?(_("✅ 数据查询成功，找到 ".concat(t.length," 条记录")),t[0].id&&(_("测试更新数据..."),await a.Y.update("conversations",t[0].id,{answer:"这是更新后的测试回答"}),_("✅ 数据更新成功"),_("测试删除数据..."),await a.Y.delete("conversations",t[0].id),_("✅ 数据删除成功"))):_("❌ 数据查询失败",!1)}catch(e){_("❌ 数据库操作失败: ".concat(e.message),!1)}}catch(e){_("❌ 测试过程中出现错误: ".concat(e.message),!1),t("测试失败")}finally{l(!1)}};return(0,r.useEffect)(()=>{d()},[]),(0,n.jsxs)("div",{className:o().container,children:[(0,n.jsxs)("nav",{className:o().navbar,children:[(0,n.jsx)("div",{className:o().logo,children:"方略 - 数据库测试"}),(0,n.jsxs)("div",{className:o().navLinks,children:[(0,n.jsx)("a",{href:"/",className:o().navLink,children:"返回首页"}),(0,n.jsx)("a",{href:"/ask",className:o().navLink,children:"问答页面"}),(0,n.jsxs)("div",{className:o().dbStatus,children:["数据库: ",e]})]})]}),(0,n.jsx)("main",{className:o().mainContent,children:(0,n.jsxs)("div",{className:o().questionForm,children:[(0,n.jsx)("h1",{children:"Supabase 数据库测试"}),(0,n.jsx)("p",{children:"这个页面用于测试 Supabase 数据库的连接和基本 CRUD 操作。"}),(0,n.jsx)("button",{onClick:d,disabled:c,className:o().submitButton,style:{marginBottom:"2rem"},children:c?"测试进行中...":"重新运行测试"}),(0,n.jsxs)("div",{style:{background:"#f5f5f5",padding:"1rem",borderRadius:"8px",maxHeight:"400px",overflowY:"auto"},children:[(0,n.jsx)("h3",{children:"测试结果:"}),0===s.length?(0,n.jsx)("p",{children:"暂无测试结果"}):s.map((e,t)=>(0,n.jsxs)("div",{style:{padding:"0.5rem 0",borderBottom:"1px solid #ddd",color:e.success?"#4CAF50":"#f44336"},children:[(0,n.jsxs)("span",{style:{fontSize:"0.8rem",color:"#666"},children:["[",e.time,"]"]})," ",e.message]},t))]})]})}),(0,n.jsx)("footer",{className:o().footer,children:(0,n.jsx)("p",{children:"\xa9 2024 方略. 数据库测试页面."})})]})}},8339:function(e){e.exports={container:"Ask_container__K8Er4",navbar:"Ask_navbar__nZK1Y",brand:"Ask_brand__kNLBD",navLinks:"Ask_navLinks__dRjsn",navLink:"Ask_navLink__QzufV",dbStatus:"Ask_dbStatus__dVUJK",mainContent:"Ask_mainContent__AMGTl",header:"Ask_header__PTw99",title:"Ask_title__omFmW",subtitle:"Ask_subtitle__hitrC",questionForm:"Ask_questionForm__WUnSJ",inputGroup:"Ask_inputGroup__epmN7",questionInput:"Ask_questionInput__oIowT",strategySection:"Ask_strategySection__bOqWF",strategyTitle:"Ask_strategyTitle__V9Cn_",strategySubtitle:"Ask_strategySubtitle__K2DYa",strategyGrid:"Ask_strategyGrid__CqRp9",strategyOption:"Ask_strategyOption__bkvtG",selected:"Ask_selected__7JCMj",strategyCheckbox:"Ask_strategyCheckbox__tr7B_",checkbox:"Ask_checkbox__hl8gQ",checkboxLabel:"Ask_checkboxLabel__64Jur",strategyLabel:"Ask_strategyLabel__J_FWp",strategyDescription:"Ask_strategyDescription__ohVNe",submitButton:"Ask_submitButton__tig4h"}}},function(e){e.O(0,[608,774,888,179],function(){return e(e.s=4794)}),_N_E=e.O()}]);