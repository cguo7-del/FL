(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5557:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(4081)}])},5981:function(e,t,r){"use strict";r.d(t,{G_:function(){return u},YX:function(){return d},r5:function(){return c},supabase:function(){return i},x0:function(){return l}});var n=r(1608),s=r(3454);let o=s.env.SUPABASE_URL||"https://crnfwlpcxrnqfgwqnmun.supabase.co",a=s.env.SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNybmZ3bHBjeHJucWZnd3FubXVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNTAzMDQsImV4cCI6MjA3MDcyNjMwNH0.g_HmFQQiuGW2TZRzZ5gqCj098DZy6iwn_xQAE6kEUEI",i=(0,n.eI)(o,a),l=e=>{let t="";return("string"==typeof e?t=e:(null==e?void 0:e.message)?t=e.message:(null==e?void 0:e.error_description)&&(t=e.error_description),t.toLowerCase().includes("new password should be different"))?"新密码不能与旧密码相同":({"Invalid login credentials":"邮箱或密码错误","Email not confirmed":"邮箱未验证，请检查您的邮箱","User already registered":"该邮箱已注册","Password should be at least 6 characters":"密码至少需要6位字符","Signup requires a valid password":"注册需要有效的密码","Invalid email":"邮箱格式不正确","Email rate limit exceeded":"邮件发送频率过高，请稍后再试","Too many requests":"请求过于频繁，请稍后再试","Network request failed":"网络请求失败，请检查网络连接","User not found":"用户不存在","Email already taken":"该邮箱已被使用","Weak password":"密码强度不够，请使用更复杂的密码","New password should be different from the old password":"新密码不能与旧密码相同","new password should be different from the old password":"新密码不能与旧密码相同","Password update failed":"密码更新失败，请稍后重试","Session not found":"会话已过期，请重新获取重置链接","Invalid recovery token":"重置链接无效或已过期，请重新申请","Auth session missing":"认证会话缺失，请重新获取重置链接"})[t]||t||"发生未知错误，请稍后重试"},c={async signUp(e,t,r){try{let{data:n,error:s}=await i.auth.signUp({email:e,password:t,options:{data:{username:r},emailRedirectTo:"".concat("https://fanglue.org","/auth")}});if(s)throw Error(l(s));return n}catch(e){throw Error(l(e))}},async signIn(e,t){try{let{data:r,error:n}=await i.auth.signInWithPassword({email:e,password:t});if(n)throw Error(l(n));return r}catch(e){throw Error(l(e))}},async signOut(){try{let{error:e}=await i.auth.signOut();if(e)throw Error(l(e));return!0}catch(e){throw Error(l(e))}},async getCurrentUser(){try{let{data:{user:e},error:t}=await i.auth.getUser();if(t)throw Error(l(t));return e}catch(e){throw Error(l(e))}},onAuthStateChange:e=>i.auth.onAuthStateChange(e)},d={supabase:i,async insert(e,t){let{data:r,error:n}=await i.from(e).insert(t).select();if(n)throw console.error("插入数据错误:",n),n;return r},async select(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.from(e).select("*");Object.entries(t).forEach(e=>{let[t,n]=e;r=r.eq(t,n)});let{data:n,error:s}=await r;if(s)throw console.error("查询数据错误:",s),s;return n},async update(e,t,r){let{data:n,error:s}=await i.from(e).update(r).eq("id",t).select();if(s)throw console.error("更新数据错误:",s),s;return n},async delete(e,t){let{error:r}=await i.from(e).delete().eq("id",t);if(r)throw console.error("删除数据错误:",r),r;return!0},async testConnection(){try{let{data:e,error:t}=await i.rpc("version");if(t){let{error:e}=await i.from("test_connection_table").select("*").limit(1);if(e&&("PGRST116"===e.code||"42P01"===e.code))return console.log("数据库连接成功!"),!0;return console.error("数据库连接测试失败:",e||t),!1}return console.log("数据库连接成功!"),!0}catch(e){return console.error("连接测试异常:",e),!1}}},u={async saveCollection(e,t,r){try{let{data:n,error:s}=await i.from("user_collections").insert({user_id:e,question:t,answer:r}).select();if(s)throw console.error("收藏保存失败:",s),s;return n[0]}catch(e){throw console.error("收藏操作异常:",e),e}},async getUserCollections(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;try{let n=(t-1)*r,{data:s,error:o,count:a}=await i.from("user_collections").select("*",{count:"exact"}).eq("user_id",e).order("updated_at",{ascending:!1}).range(n,n+r-1);if(o)throw console.error("获取收藏列表失败:",o),o;return{data:s||[],total:a||0,page:t,pageSize:r,totalPages:Math.ceil((a||0)/r)}}catch(e){throw console.error("获取收藏列表异常:",e),e}},async deleteCollections(e){try{let{error:t}=await i.from("user_collections").delete().in("id",e);if(t)throw console.error("删除收藏失败:",t),t;return!0}catch(e){throw console.error("删除收藏异常:",e),e}},async checkIfCollected(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{let n=i.from("user_collections").select("id").eq("user_id",e).eq("question",t);r&&(n=n.ilike("answer","%".concat(r,"%")));let{data:s,error:o}=await n.limit(1);if(o)throw console.error("检查收藏状态失败:",o),o;return s&&s.length>0}catch(e){throw console.error("检查收藏状态异常:",e),e}}}},4081:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var n=r(5893),s=r(7294),o=r(9008),a=r.n(o),i=r(1163),l=r(9647),c=r.n(l),d=r(5981);function u(){var e;let t=(0,i.useRouter)(),[r,o]=(0,s.useState)(null),[l,u]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{try{let e=await d.r5.getCurrentUser();o(e)}catch(e){o(null)}})();let{data:{subscription:e}}=d.r5.onAuthStateChange((e,t)=>{"SIGNED_IN"===e?o((null==t?void 0:t.user)||null):"SIGNED_OUT"===e&&o(null)});return()=>e.unsubscribe()},[]);let h=async()=>{try{await d.r5.signOut(),u(!1)}catch(e){console.error("登出错误:",e)}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(a(),{children:[(0,n.jsx)("title",{children:"方略 Fanglue"}),(0,n.jsx)("meta",{name:"description",content:"从经史到兵法，古智与算法，同答一问"}),(0,n.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,n.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,n.jsxs)("div",{className:c().container,children:[(0,n.jsxs)("nav",{className:c().navbar,children:[(0,n.jsx)("div",{className:c().brand,children:"方略 Fanglue"}),(0,n.jsx)("div",{className:c().navLinks,children:r?(0,n.jsxs)("div",{className:c().userMenu,children:[(0,n.jsxs)("button",{className:c().userButton,onClick:()=>u(!l),children:[(null===(e=r.user_metadata)||void 0===e?void 0:e.username)||r.email,(0,n.jsx)("span",{className:c().dropdownArrow,children:"▼"})]}),l&&(0,n.jsxs)("div",{className:c().dropdown,children:[(0,n.jsx)("button",{className:c().dropdownItem,onClick:()=>{u(!1),t.push("/profile")},children:"个人资料"}),(0,n.jsx)("button",{className:c().dropdownItem,onClick:()=>{u(!1),t.push("/collection")},children:"历问历答"}),(0,n.jsx)("hr",{className:c().dropdownDivider}),(0,n.jsx)("button",{className:c().dropdownItem,onClick:h,children:"退出登录"})]})]}):(0,n.jsx)("button",{className:c().authBtn,onClick:()=>t.push("/auth"),children:"注册/登录"})})]}),(0,n.jsxs)("main",{className:c().mainContent,children:[(0,n.jsxs)("div",{className:c().mainTitle,children:[(0,n.jsx)("div",{className:c().titleLine,children:"三十息，问古今"}),(0,n.jsx)("div",{className:c().titleLine,children:"千年略，解一念"}),(0,n.jsx)("div",{className:c().subtitle,children:"从经史到兵法，古智与算法，同答一问"})]}),(0,n.jsx)("a",{href:"/ask",className:c().mainButton,children:"立即寻索"}),(0,n.jsxs)("div",{className:c().features,children:[(0,n.jsxs)("div",{className:c().featureItem,children:[(0,n.jsx)("div",{className:c().featureIcon,children:(0,n.jsx)("img",{src:"/icons/explore-source.svg",alt:"探源",width:"60",height:"60"})}),(0,n.jsx)("div",{className:c().featureTitle,children:"探源"}),(0,n.jsxs)("div",{className:c().featureDesc,children:["溯古问道",(0,n.jsx)("br",{}),"择智珠以为引"]})]}),(0,n.jsxs)("div",{className:c().featureItem,children:[(0,n.jsx)("div",{className:c().featureIcon,children:(0,n.jsx)("img",{src:"/icons/analyze-situation.svg",alt:"析局",width:"60",height:"60"})}),(0,n.jsx)("div",{className:c().featureTitle,children:"析局"}),(0,n.jsxs)("div",{className:c().featureDesc,children:["洞察机枢",(0,n.jsx)("br",{}),"见万变之本脉"]})]}),(0,n.jsxs)("div",{className:c().featureItem,children:[(0,n.jsx)("div",{className:c().featureIcon,children:(0,n.jsx)("img",{src:"/icons/execute-strategy.svg",alt:"行策",width:"60",height:"60"})}),(0,n.jsx)("div",{className:c().featureTitle,children:"行策"}),(0,n.jsxs)("div",{className:c().featureDesc,children:["授你谋纲",(0,n.jsx)("br",{}),"行于九地八方"]})]})]})]}),(0,n.jsxs)("footer",{className:c().footerSection,children:[(0,n.jsx)("div",{className:c().footerTitle,children:"让千载经略，为你今日一策"}),(0,n.jsxs)("div",{className:c().footerButtons,children:[(0,n.jsx)("a",{href:"#",className:c().footerBtn,title:"功能开发中，敬请期待",children:"众议百解"}),(0,n.jsx)("a",{href:"#",className:c().footerBtn,title:"功能开发中，敬请期待",children:"一日一策"}),(0,n.jsx)("a",{href:"/collection",className:c().footerBtn,children:"历问历答"})]})]})]})]})}},9647:function(e){e.exports={container:"Home_container__d256j",navbar:"Home_navbar__IWq_R",brand:"Home_brand__Aafw0",navLinks:"Home_navLinks___tPFn",authBtn:"Home_authBtn__56DuA",userMenu:"Home_userMenu__EE6T3",userButton:"Home_userButton__gV6hD",dropdownArrow:"Home_dropdownArrow__3dQSO",dropdown:"Home_dropdown__1dIW0",dropdownFadeIn:"Home_dropdownFadeIn__sT3aT",dropdownItem:"Home_dropdownItem__1IKVT",dropdownDivider:"Home_dropdownDivider__mb1j3",mainContent:"Home_mainContent__RtoDJ",mainTitle:"Home_mainTitle__o5VAj",titleLine:"Home_titleLine___ojxh",subtitle:"Home_subtitle__KzT68",mainButton:"Home_mainButton__nIVdf",features:"Home_features__I7Csk",featureItem:"Home_featureItem__lQpto",featureIcon:"Home_featureIcon__rV5mF",featureTitle:"Home_featureTitle__Bmu0V",featureDesc:"Home_featureDesc__KtiIW",footerSection:"Home_footerSection__t4Rwp",footerTitle:"Home_footerTitle__gBSeU",footerButtons:"Home_footerButtons__CVxxr",footerBtn:"Home_footerBtn__CAGid"}},9008:function(e,t,r){e.exports=r(4764)},1163:function(e,t,r){e.exports=r(2937)}},function(e){e.O(0,[608,774,888,179],function(){return e(e.s=5557)}),_N_E=e.O()}]);