(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[777],{4794:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/test-db",function(){return r(3502)}])},5981:function(e,t,r){"use strict";r.d(t,{G_:function(){return _},YX:function(){return d},r5:function(){return l},supabase:function(){return i},x0:function(){return c}});var s=r(1608),o=r(3454);let n=o.env.SUPABASE_URL||"https://crnfwlpcxrnqfgwqnmun.supabase.co",a=o.env.SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNybmZ3bHBjeHJucWZnd3FubXVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNTAzMDQsImV4cCI6MjA3MDcyNjMwNH0.g_HmFQQiuGW2TZRzZ5gqCj098DZy6iwn_xQAE6kEUEI",i=(0,s.eI)(n,a),c=e=>{let t="";return("string"==typeof e?t=e:(null==e?void 0:e.message)?t=e.message:(null==e?void 0:e.error_description)&&(t=e.error_description),t.toLowerCase().includes("new password should be different"))?"新密码不能与旧密码相同":({"Invalid login credentials":"邮箱或密码错误","Email not confirmed":"邮箱未验证，请检查您的邮箱","User already registered":"该邮箱已注册","Password should be at least 6 characters":"密码至少需要6位字符","Signup requires a valid password":"注册需要有效的密码","Invalid email":"邮箱格式不正确","Email rate limit exceeded":"邮件发送频率过高，请稍后再试","Too many requests":"请求过于频繁，请稍后再试","Network request failed":"网络请求失败，请检查网络连接","User not found":"用户不存在","Email already taken":"该邮箱已被使用","Weak password":"密码强度不够，请使用更复杂的密码","New password should be different from the old password":"新密码不能与旧密码相同","new password should be different from the old password":"新密码不能与旧密码相同","Password update failed":"密码更新失败，请稍后重试","Session not found":"会话已过期，请重新获取重置链接","Invalid recovery token":"重置链接无效或已过期，请重新申请","Auth session missing":"认证会话缺失，请重新获取重置链接"})[t]||t||"发生未知错误，请稍后重试"},l={async signUp(e,t,r){try{let{data:s,error:o}=await i.auth.signUp({email:e,password:t,options:{data:{username:r},emailRedirectTo:"".concat("https://fanglue.org","/auth")}});if(o)throw Error(c(o));return s}catch(e){throw Error(c(e))}},async signIn(e,t){try{let{data:r,error:s}=await i.auth.signInWithPassword({email:e,password:t});if(s)throw Error(c(s));return r}catch(e){throw Error(c(e))}},async signOut(){try{let{error:e}=await i.auth.signOut();if(e)throw Error(c(e));return!0}catch(e){throw Error(c(e))}},async getCurrentUser(){try{let{data:{user:e},error:t}=await i.auth.getUser();if(t)throw Error(c(t));return e}catch(e){throw Error(c(e))}},onAuthStateChange:e=>i.auth.onAuthStateChange(e)},d={supabase:i,async insert(e,t){let{data:r,error:s}=await i.from(e).insert(t).select();if(s)throw console.error("插入数据错误:",s),s;return r},async select(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.from(e).select("*");Object.entries(t).forEach(e=>{let[t,s]=e;r=r.eq(t,s)});let{data:s,error:o}=await r;if(o)throw console.error("查询数据错误:",o),o;return s},async update(e,t,r){let{data:s,error:o}=await i.from(e).update(r).eq("id",t).select();if(o)throw console.error("更新数据错误:",o),o;return s},async delete(e,t){let{error:r}=await i.from(e).delete().eq("id",t);if(r)throw console.error("删除数据错误:",r),r;return!0},async testConnection(){try{let{data:e,error:t}=await i.rpc("version");if(t){let{error:e}=await i.from("test_connection_table").select("*").limit(1);if(e&&("PGRST116"===e.code||"42P01"===e.code))return console.log("数据库连接成功!"),!0;return console.error("数据库连接测试失败:",e||t),!1}return console.log("数据库连接成功!"),!0}catch(e){return console.error("连接测试异常:",e),!1}}},_={async saveCollection(e,t,r){try{let{data:s,error:o}=await i.from("user_collections").insert({user_id:e,question:t,answer:r}).select();if(o)throw console.error("收藏保存失败:",o),o;return s[0]}catch(e){throw console.error("收藏操作异常:",e),e}},async getUserCollections(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;try{let s=(t-1)*r,{data:o,error:n,count:a}=await i.from("user_collections").select("*",{count:"exact"}).eq("user_id",e).order("updated_at",{ascending:!1}).range(s,s+r-1);if(n)throw console.error("获取收藏列表失败:",n),n;return{data:o||[],total:a||0,page:t,pageSize:r,totalPages:Math.ceil((a||0)/r)}}catch(e){throw console.error("获取收藏列表异常:",e),e}},async deleteCollections(e){try{let{error:t}=await i.from("user_collections").delete().in("id",e);if(t)throw console.error("删除收藏失败:",t),t;return!0}catch(e){throw console.error("删除收藏异常:",e),e}},async checkIfCollected(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{let s=i.from("user_collections").select("id").eq("user_id",e).eq("question",t);r&&(s=s.ilike("answer","%".concat(r,"%")));let{data:o,error:n}=await s.limit(1);if(n)throw console.error("检查收藏状态失败:",n),n;return o&&o.length>0}catch(e){throw console.error("检查收藏状态异常:",e),e}}}},3502:function(e,t,r){"use strict";r.r(t);var s=r(5893),o=r(7294),n=r(5981),a=r(8339),i=r.n(a);t.default=()=>{let[e,t]=(0,o.useState)("测试中..."),[r,a]=(0,o.useState)([]),[c,l]=(0,o.useState)(!1),d=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];a(r=>[...r,{message:e,success:t,time:new Date().toLocaleTimeString()}])},_=async()=>{l(!0),a([]);try{if(d("开始测试数据库连接..."),await n.YX.testConnection())d("✅ 数据库连接成功"),t("已连接");else{d("❌ 数据库连接失败",!1),t("连接失败");return}d("测试插入数据...");let e={question:"这是一个测试问题",answer:"这是一个测试回答",created_at:new Date().toISOString()};try{await n.YX.insert("conversations",e),d("✅ 数据插入成功"),d("测试查询数据...");let t=await n.YX.select("conversations",{question:"这是一个测试问题"});t&&t.length>0?(d("✅ 数据查询成功，找到 ".concat(t.length," 条记录")),t[0].id&&(d("测试更新数据..."),await n.YX.update("conversations",t[0].id,{answer:"这是更新后的测试回答"}),d("✅ 数据更新成功"),d("测试删除数据..."),await n.YX.delete("conversations",t[0].id),d("✅ 数据删除成功"))):d("❌ 数据查询失败",!1)}catch(e){d("❌ 数据库操作失败: ".concat(e.message),!1)}}catch(e){d("❌ 测试过程中出现错误: ".concat(e.message),!1),t("测试失败")}finally{l(!1)}};return(0,o.useEffect)(()=>{_()},[]),(0,s.jsxs)("div",{className:i().container,children:[(0,s.jsxs)("nav",{className:i().navbar,children:[(0,s.jsx)("div",{className:i().logo,children:"方略 - 数据库测试"}),(0,s.jsxs)("div",{className:i().navLinks,children:[(0,s.jsx)("a",{href:"/",className:i().navLink,children:"返回首页"}),(0,s.jsx)("a",{href:"/ask",className:i().navLink,children:"问答页面"}),(0,s.jsxs)("div",{className:i().dbStatus,children:["数据库: ",e]})]})]}),(0,s.jsx)("main",{className:i().mainContent,children:(0,s.jsxs)("div",{className:i().questionForm,children:[(0,s.jsx)("h1",{children:"Supabase 数据库测试"}),(0,s.jsx)("p",{children:"这个页面用于测试 Supabase 数据库的连接和基本 CRUD 操作。"}),(0,s.jsx)("button",{onClick:_,disabled:c,className:i().submitButton,style:{marginBottom:"2rem"},children:c?"测试进行中...":"重新运行测试"}),(0,s.jsxs)("div",{style:{background:"#f5f5f5",padding:"1rem",borderRadius:"8px",maxHeight:"400px",overflowY:"auto"},children:[(0,s.jsx)("h3",{children:"测试结果:"}),0===r.length?(0,s.jsx)("p",{children:"暂无测试结果"}):r.map((e,t)=>(0,s.jsxs)("div",{style:{padding:"0.5rem 0",borderBottom:"1px solid #ddd",color:e.success?"#4CAF50":"#f44336"},children:[(0,s.jsxs)("span",{style:{fontSize:"0.8rem",color:"#666"},children:["[",e.time,"]"]})," ",e.message]},t))]})]})}),(0,s.jsx)("footer",{className:i().footer,children:(0,s.jsx)("p",{children:"\xa9 2024 方略. 数据库测试页面."})})]})}},8339:function(e){e.exports={container:"Ask_container__K8Er4",navbar:"Ask_navbar__nZK1Y",brand:"Ask_brand__kNLBD",navLinks:"Ask_navLinks__dRjsn",authBtn:"Ask_authBtn__l2xrS",userMenu:"Ask_userMenu__5eOq_",userButton:"Ask_userButton__TBO8d",dropdownArrow:"Ask_dropdownArrow__WcdlR",dropdown:"Ask_dropdown__wHqcJ",dropdownFadeIn:"Ask_dropdownFadeIn__P3Inw",dropdownItem:"Ask_dropdownItem__CscLM",dropdownDivider:"Ask_dropdownDivider__lyHJ6",mainContent:"Ask_mainContent__AMGTl",header:"Ask_header__PTw99",title:"Ask_title__omFmW",subtitle:"Ask_subtitle__hitrC",questionForm:"Ask_questionForm__WUnSJ",inputGroup:"Ask_inputGroup__epmN7",questionInput:"Ask_questionInput__oIowT",strategySection:"Ask_strategySection__bOqWF",strategyTitle:"Ask_strategyTitle__V9Cn_",strategySubtitle:"Ask_strategySubtitle__K2DYa",strategyGrid:"Ask_strategyGrid__CqRp9",strategyOption:"Ask_strategyOption__bkvtG",selected:"Ask_selected__7JCMj",strategyCheckbox:"Ask_strategyCheckbox__tr7B_",checkbox:"Ask_checkbox__hl8gQ",checkboxLabel:"Ask_checkboxLabel__64Jur",strategyLabel:"Ask_strategyLabel__J_FWp",submitButton:"Ask_submitButton__tig4h",loading:"Ask_loading___q74m",progressBar:"Ask_progressBar__2yGF1",progressFill:"Ask_progressFill__fkxfB",progressText:"Ask_progressText__Os8pk",footerSection:"Ask_footerSection__EN4Qi",footerTitle:"Ask_footerTitle__e76h_",footerButtons:"Ask_footerButtons__JX7La",footerBtn:"Ask_footerBtn__luBWq"}}},function(e){e.O(0,[608,774,888,179],function(){return e(e.s=4794)}),_N_E=e.O()}]);