(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[777],{4794:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/test-db",function(){return n(3502)}])},5981:function(e,t,n){"use strict";n.d(t,{Y:function(){return r}});let s=(0,n(1608).eI)("https://crnfwlpcxrnqfgwqnmun.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNybmZ3bHBjeHJucWZnd3FubXVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNTAzMDQsImV4cCI6MjA3MDcyNjMwNH0.g_HmFQQiuGW2TZRzZ5gqCj098DZy6iwn_xQAE6kEUEI"),r={async insert(e,t){let{data:n,error:r}=await s.from(e).insert(t).select();if(r)throw console.error("插入数据错误:",r),r;return n},async select(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=s.from(e).select("*");Object.entries(t).forEach(e=>{let[t,s]=e;n=n.eq(t,s)});let{data:r,error:a}=await n;if(a)throw console.error("查询数据错误:",a),a;return r},async update(e,t,n){let{data:r,error:a}=await s.from(e).update(n).eq("id",t).select();if(a)throw console.error("更新数据错误:",a),a;return r},async delete(e,t){let{error:n}=await s.from(e).delete().eq("id",t);if(n)throw console.error("删除数据错误:",n),n;return!0},async testConnection(){try{let{data:e,error:t}=await s.rpc("version");if(t){let{error:e}=await s.from("test_connection_table").select("*").limit(1);if(e&&("PGRST116"===e.code||"42P01"===e.code))return console.log("数据库连接成功!"),!0;return console.error("数据库连接测试失败:",e||t),!1}return console.log("数据库连接成功!"),!0}catch(e){return console.error("连接测试异常:",e),!1}}}},3502:function(e,t,n){"use strict";n.r(t);var s=n(5893),r=n(7294),a=n(5981),i=n(8339),o=n.n(i);t.default=()=>{let[e,t]=(0,r.useState)("测试中..."),[n,i]=(0,r.useState)([]),[c,l]=(0,r.useState)(!1),_=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];i(n=>[...n,{message:e,success:t,time:new Date().toLocaleTimeString()}])},u=async()=>{l(!0),i([]);try{if(_("开始测试数据库连接..."),await a.Y.testConnection())_("✅ 数据库连接成功"),t("已连接");else{_("❌ 数据库连接失败",!1),t("连接失败");return}_("测试插入数据...");let e={question:"这是一个测试问题",answer:"这是一个测试回答",created_at:new Date().toISOString()};try{await a.Y.insert("conversations",e),_("✅ 数据插入成功"),_("测试查询数据...");let t=await a.Y.select("conversations",{question:"这是一个测试问题"});t&&t.length>0?(_("✅ 数据查询成功，找到 ".concat(t.length," 条记录")),t[0].id&&(_("测试更新数据..."),await a.Y.update("conversations",t[0].id,{answer:"这是更新后的测试回答"}),_("✅ 数据更新成功"),_("测试删除数据..."),await a.Y.delete("conversations",t[0].id),_("✅ 数据删除成功"))):_("❌ 数据查询失败",!1)}catch(e){_("❌ 数据库操作失败: ".concat(e.message),!1)}}catch(e){_("❌ 测试过程中出现错误: ".concat(e.message),!1),t("测试失败")}finally{l(!1)}};return(0,r.useEffect)(()=>{u()},[]),(0,s.jsxs)("div",{className:o().container,children:[(0,s.jsxs)("nav",{className:o().navbar,children:[(0,s.jsx)("div",{className:o().logo,children:"方略 - 数据库测试"}),(0,s.jsxs)("div",{className:o().navLinks,children:[(0,s.jsx)("a",{href:"/",className:o().navLink,children:"返回首页"}),(0,s.jsx)("a",{href:"/ask",className:o().navLink,children:"问答页面"}),(0,s.jsxs)("div",{className:o().dbStatus,children:["数据库: ",e]})]})]}),(0,s.jsx)("main",{className:o().mainContent,children:(0,s.jsxs)("div",{className:o().questionForm,children:[(0,s.jsx)("h1",{children:"Supabase 数据库测试"}),(0,s.jsx)("p",{children:"这个页面用于测试 Supabase 数据库的连接和基本 CRUD 操作。"}),(0,s.jsx)("button",{onClick:u,disabled:c,className:o().submitButton,style:{marginBottom:"2rem"},children:c?"测试进行中...":"重新运行测试"}),(0,s.jsxs)("div",{style:{background:"#f5f5f5",padding:"1rem",borderRadius:"8px",maxHeight:"400px",overflowY:"auto"},children:[(0,s.jsx)("h3",{children:"测试结果:"}),0===n.length?(0,s.jsx)("p",{children:"暂无测试结果"}):n.map((e,t)=>(0,s.jsxs)("div",{style:{padding:"0.5rem 0",borderBottom:"1px solid #ddd",color:e.success?"#4CAF50":"#f44336"},children:[(0,s.jsxs)("span",{style:{fontSize:"0.8rem",color:"#666"},children:["[",e.time,"]"]})," ",e.message]},t))]})]})}),(0,s.jsx)("footer",{className:o().footer,children:(0,s.jsx)("p",{children:"\xa9 2024 方略. 数据库测试页面."})})]})}},8339:function(e){e.exports={container:"Ask_container__K8Er4",navbar:"Ask_navbar__nZK1Y",brand:"Ask_brand__kNLBD",navLinks:"Ask_navLinks__dRjsn",navLink:"Ask_navLink__QzufV",dbStatus:"Ask_dbStatus__dVUJK",mainContent:"Ask_mainContent__AMGTl",header:"Ask_header__PTw99",title:"Ask_title__omFmW",subtitle:"Ask_subtitle__hitrC",questionForm:"Ask_questionForm__WUnSJ",inputGroup:"Ask_inputGroup__epmN7",questionInput:"Ask_questionInput__oIowT",submitButton:"Ask_submitButton__tig4h",answerSection:"Ask_answerSection__jXE7p",answerTitle:"Ask_answerTitle__rUmIN",answerContent:"Ask_answerContent__DpQr7",features:"Ask_features__g87Oj",featureItem:"Ask_featureItem__8vyTs",featureIcon:"Ask_featureIcon__i_Vbr",featureText:"Ask_featureText__g8Rhu",featureTitle:"Ask_featureTitle__P2uic",featureDesc:"Ask_featureDesc__Smmzb",footer:"Ask_footer__sIceh"}}},function(e){e.O(0,[608,774,888,179],function(){return e(e.s=4794)}),_N_E=e.O()}]);