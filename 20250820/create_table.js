const { createClient } = require('@supabase/supabase-js')
const fs = require('fs')

// Supabase配置
const supabaseUrl = 'https://crnfwlpcxrnqfgwqnmun.supabase.co'
const supabaseServiceKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNybmZ3bHBjeHJucWZnd3FubXVuIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NTE1MDMwNCwiZXhwIjoyMDcwNzI2MzA0fQ.mMCVXnY4JaeUZcUAcXPnHox3rqtM_eO18dx6aW1xFII'

// 创建Supabase客户端
const supabase = createClient(supabaseUrl, supabaseServiceKey)

async function createBookLibraryTable() {
  try {
    console.log('开始插入book_library数据...')
    
    // 定义书籍数据
    const bookData = [
      // 行正持礼
      {
        '书籍名称': '论语',
        '方略经纬': '行正持礼',
        '章节名称': '学而第一',
        '章节内容': '子曰："学而时习之，不亦说乎？有朋自远方来，不亦乐乎？人不知而不愠，不亦君子乎？"有子曰："其为人也孝弟，而好犯上者，鲜矣；不好犯上而好作乱者，未之有也。君子务本，本立而道生。孝弟也者，其为仁之本与！"'
      },
      {
        '书籍名称': '论语',
        '方略经纬': '行正持礼',
        '章节名称': '为政第二',
        '章节内容': '子曰："为政以德，譬如北辰，居其所而众星共之。"子曰："《诗》三百，一言以蔽之，曰：\'思无邪\'。"子曰："道之以政，齐之以刑，民免而无耻；道之以德，齐之以礼，有耻且格。"'
      },
      {
        '书籍名称': '孟子',
        '方略经纬': '行正持礼',
        '章节名称': '梁惠王章句上',
        '章节内容': '孟子见梁惠王。王曰："叟！不远千里而来，亦将有以利吾国乎？"孟子对曰："王！何必曰利？亦有仁义而已矣。王曰\'何以利吾国\'，大夫曰\'何以利吾家\'，士庶人曰\'何以利吾身\'，上下交征利而国危矣。"'
      },
      {
        '书籍名称': '孟子',
        '方略经纬': '行正持礼',
        '章节名称': '公孙丑章句上',
        '章节内容': '孟子曰："夫仁，天之尊爵也，人之安宅也。莫之御而不仁，是不智也。不仁、不智、无礼、无义，人役也。人役而耻为役，由弓人而耻为弓，矢人而耻为矢也。如耻之，莫如为仁。仁者如射：射者正己而后发；发而不中，不怨胜己者，反求诸己而已矣。"'
      },
      // 顺势而为
      {
        '书籍名称': '道德经',
        '方略经纬': '顺势而为',
        '章节名称': '第一章',
        '章节内容': '道可道，非常道。名可名，非常名。无名天地之始；有名万物之母。故常无，欲以观其妙；常有，欲以观其徼。此两者，同出而异名，同谓之玄。玄之又玄，众妙之门。'
      },
      {
        '书籍名称': '道德经',
        '方略经纬': '顺势而为',
        '章节名称': '第八章',
        '章节内容': '上善若水。水善利万物而不争，处众人之所恶，故几于道。居善地，心善渊，与善仁，言善信，政善治，事善能，动善时。夫唯不争，故无尤。'
      },
      {
        '书籍名称': '庄子',
        '方略经纬': '顺势而为',
        '章节名称': '逍遥游',
        '章节内容': '北冥有鱼，其名为鲲。鲲之大，不知其几千里也。化而为鸟，其名为鹏。鹏之背，不知其几千里也；怒而飞，其翼若垂天之云。是鸟也，海运则将徙于南冥。南冥者，天池也。'
      },
      {
        '书籍名称': '庄子',
        '方略经纬': '顺势而为',
        '章节名称': '齐物论',
        '章节内容': '天地与我并生，而万物与我为一。既已为一矣，且得有言乎？既已谓之一矣，且得无言乎？一与言为二，二与一为三。自此以往，巧历不能得，而况其凡乎！故自无适有，以至于三，而况自有适有乎！无适焉，因是已。'
      },
      // 巧谋实战
      {
        '书籍名称': '孙子兵法',
        '方略经纬': '巧谋实战',
        '章节名称': '始计篇',
        '章节内容': '孙子曰：兵者，国之大事，死生之地，存亡之道，不可不察也。故经之以五事，校之以计，而索其情：一曰道，二曰天，三曰地，四曰将，五曰法。道者，令民与上同意也，故可以与之死，可以与之生，而不畏危。'
      },
      {
        '书籍名称': '孙子兵法',
        '方略经纬': '巧谋实战',
        '章节名称': '谋攻篇',
        '章节内容': '孙子曰：夫用兵之法，全国为上，破国次之；全军为上，破军次之；全旅为上，破旅次之；全卒为上，破卒次之；全伍为上，破伍次之。是故百战百胜，非善之善者也；不战而屈人之兵，善之善者也。'
      },
      {
        '书籍名称': '鬼谷子',
        '方略经纬': '巧谋实战',
        '章节名称': '捭阖第一',
        '章节内容': '粤若稽古圣人之在天地间也，为众生之先，观阴阳之开阖以命物，知存亡之门户，筹策万类之终始，达人心之理，见变化之朕焉，而守司其门户。故圣人之在天下也，自古及今，其道一也。'
      },
      {
        '书籍名称': '鬼谷子',
        '方略经纬': '巧谋实战',
        '章节名称': '反应第二',
        '章节内容': '古之大化者，乃与无形俱生。反以观往，复以验来；反以知古，复以知今；反以知彼，复以知己。动静虚实之理不合来今，反古而求之。事有反而得复者，圣人之意也，不可不察。'
      },
      // 运筹帷幄
      {
        '书籍名称': '韩非子',
        '方略经纬': '运筹帷幄',
        '章节名称': '孤愤',
        '章节内容': '智术之士，必远于刑戮；谏说之士，必困于诽谤；正直之士，必死于诛杀。故明主之国，无书简之文，以法为教；无先王之语，以吏为师。今巫医乐师百工之人，君子不齿，今其智乃反不能及，其可怪也欤！'
      },
      {
        '书籍名称': '韩非子',
        '方略经纬': '运筹帷幄',
        '章节名称': '五蠹',
        '章节内容': '上古之世，人民少而禽兽众，人民不胜禽兽虫蛇。有圣人作，构木为巢以避群害，而民悦之，使王天下，号之曰有巢氏。民食果蓏蚌蛤，腥臊恶臭而伤害腹胃，民多疾病。有圣人作，钻燧取火以化腥臊，而民说之，使王天下，号之曰燧人氏。'
      },
      {
        '书籍名称': '商君书',
        '方略经纬': '运筹帷幄',
        '章节名称': '更法',
        '章节内容': '孝公平画，公孙鞅曰："治世不一道，便国不法古。故汤武不循古而王，夏殷不易礼而亡。反古者不可非，而循礼者不足多。"公曰："善。"甘龙曰："不然。圣人不易民而教，知者不变法而治。因民而教，不劳而成功；缘法而治者，吏习而民安之。"'
      },
      {
        '书籍名称': '商君书',
        '方略经纬': '运筹帷幄',
        '章节名称': '农战',
        '章节内容': '凡人主之所以劝民者，官爵也；国之所以兴者，农战也。今民求官爵，皆不以农战，而以巧言虚道，此谓劳民。劳民者，其国必无力；无力者，其国必削。善为国者，仓廪虽满，不偷于农；国大民众，不淫于言。'
      }
    ]
    
    // 分批插入数据
    const batchSize = 5
    for (let i = 0; i < bookData.length; i += batchSize) {
      const batch = bookData.slice(i, i + batchSize)
      console.log(`插入第 ${Math.floor(i/batchSize) + 1} 批数据 (${batch.length} 条记录)...`)
      
      const { data, error } = await supabase
        .from('book_library')
        .insert(batch)
      
      if (error) {
        console.error(`插入第 ${Math.floor(i/batchSize) + 1} 批数据时出错:`, error)
      } else {
        console.log(`第 ${Math.floor(i/batchSize) + 1} 批数据插入成功`)
      }
    }
    
    console.log('book_library数据插入完成！')
    
    // 验证数据是否插入成功
    const { data: tableData, error: tableError } = await supabase
      .from('book_library')
      .select('*', { count: 'exact' })
    
    if (tableError) {
      console.error('验证数据插入失败:', tableError)
    } else {
      console.log('数据验证成功，当前记录数:', tableData.length)
      console.log('各方略经纬的书籍数量:')
      const categories = {}
      tableData.forEach(item => {
        categories[item.方略经纬] = (categories[item.方略经纬] || 0) + 1
      })
      console.log(categories)
    }
    
  } catch (error) {
    console.error('插入数据时发生错误:', error)
  }
}

// 执行函数
createBookLibraryTable()