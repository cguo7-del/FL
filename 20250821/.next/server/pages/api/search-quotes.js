"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/search-quotes";
exports.ids = ["pages/api/search-quotes"];
exports.modules = {

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = require("@supabase/supabase-js");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fsearch-quotes&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fsearch-quotes.js&middlewareConfigBase64=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fsearch-quotes&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fsearch-quotes.js&middlewareConfigBase64=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_search_quotes_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/search-quotes.js */ \"(api)/./pages/api/search-quotes.js\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_search_quotes_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_search_quotes_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/search-quotes\",\n        pathname: \"/api/search-quotes\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_search_quotes_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnNlYXJjaC1xdW90ZXMmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyUyRmFwaSUyRnNlYXJjaC1xdW90ZXMuanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDeUQ7QUFDekQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLHdEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyx3REFBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9mYW5nbHVlLXdlYnNpdGUvP2VkNmQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzL2FwaS9zZWFyY2gtcXVvdGVzLmpzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsIFwiZGVmYXVsdFwiKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsIFwiY29uZmlnXCIpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5leHBvcnQgY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgUGFnZXNBUElSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuUEFHRVNfQVBJLFxuICAgICAgICBwYWdlOiBcIi9hcGkvc2VhcmNoLXF1b3Rlc1wiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3NlYXJjaC1xdW90ZXNcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fsearch-quotes&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fsearch-quotes.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/supabase.js":
/*!*************************!*\
  !*** ./lib/supabase.js ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authOperations: () => (/* binding */ authOperations),\n/* harmony export */   collectionOperations: () => (/* binding */ collectionOperations),\n/* harmony export */   dbOperations: () => (/* binding */ dbOperations),\n/* harmony export */   localizeSupabaseError: () => (/* binding */ localizeSupabaseError),\n/* harmony export */   supabase: () => (/* binding */ supabase)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__);\n\n// Supabase配置 - 支持环境变量和fallback\nconst supabaseUrl = process.env.SUPABASE_URL || \"https://crnfwlpcxrnqfgwqnmun.supabase.co\";\nconst supabaseAnonKey = process.env.SUPABASE_ANON_KEY || \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNybmZ3bHBjeHJucWZnd3FubXVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNTAzMDQsImV4cCI6MjA3MDcyNjMwNH0.g_HmFQQiuGW2TZRzZ5gqCj098DZy6iwn_xQAE6kEUEI\";\n// 创建Supabase客户端实例\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey);\n// Supabase错误信息本地化\nconst localizeSupabaseError = (error)=>{\n    const errorMessages = {\n        \"Invalid login credentials\": \"登录凭证无效，请检查邮箱和密码\",\n        \"Email not confirmed\": \"邮箱未验证，请检查您的邮箱并点击验证链接\",\n        \"User already registered\": \"该邮箱已被注册，请使用其他邮箱或直接登录\",\n        \"Password should be at least 6 characters\": \"密码至少需要6个字符\",\n        \"Signup requires a valid password\": \"注册需要有效的密码\",\n        \"Invalid email\": \"邮箱格式不正确\",\n        \"Email rate limit exceeded\": \"邮件发送频率过高，请稍后再试\",\n        \"Too many requests\": \"请求过于频繁，请稍后再试\",\n        \"Network request failed\": \"网络请求失败，请检查网络连接\",\n        \"User not found\": \"用户不存在\",\n        \"Email already taken\": \"该邮箱已被使用\",\n        \"Weak password\": \"密码强度不够，请使用更复杂的密码\"\n    };\n    if (error?.message) {\n        return errorMessages[error.message] || error.message;\n    }\n    return \"发生未知错误，请稍后重试\";\n};\n// 认证相关功能\nconst authOperations = {\n    // 用户注册\n    async signUp (email, password, username) {\n        try {\n            const { data, error } = await supabase.auth.signUp({\n                email,\n                password,\n                options: {\n                    data: {\n                        username: username\n                    }\n                }\n            });\n            if (error) {\n                throw new Error(localizeSupabaseError(error));\n            }\n            return data;\n        } catch (error) {\n            throw new Error(localizeSupabaseError(error));\n        }\n    },\n    // 用户登录\n    async signIn (email, password) {\n        try {\n            const { data, error } = await supabase.auth.signInWithPassword({\n                email,\n                password\n            });\n            if (error) {\n                throw new Error(localizeSupabaseError(error));\n            }\n            return data;\n        } catch (error) {\n            throw new Error(localizeSupabaseError(error));\n        }\n    },\n    // 用户登出\n    async signOut () {\n        try {\n            const { error } = await supabase.auth.signOut();\n            if (error) {\n                throw new Error(localizeSupabaseError(error));\n            }\n            return true;\n        } catch (error) {\n            throw new Error(localizeSupabaseError(error));\n        }\n    },\n    // 获取当前用户\n    async getCurrentUser () {\n        try {\n            const { data: { user }, error } = await supabase.auth.getUser();\n            if (error) {\n                throw new Error(localizeSupabaseError(error));\n            }\n            return user;\n        } catch (error) {\n            throw new Error(localizeSupabaseError(error));\n        }\n    },\n    // 监听认证状态变化\n    onAuthStateChange (callback) {\n        return supabase.auth.onAuthStateChange(callback);\n    }\n};\n// 数据库操作函数\nconst dbOperations = {\n    // 暴露 supabase 客户端实例\n    supabase,\n    // 插入数据\n    async insert (table, data) {\n        const { data: result, error } = await supabase.from(table).insert(data).select();\n        if (error) {\n            console.error(\"插入数据错误:\", error);\n            throw error;\n        }\n        return result;\n    },\n    // 查询数据\n    async select (table, filters = {}) {\n        let query = supabase.from(table).select(\"*\");\n        // 应用过滤条件\n        Object.entries(filters).forEach(([key, value])=>{\n            query = query.eq(key, value);\n        });\n        const { data, error } = await query;\n        if (error) {\n            console.error(\"查询数据错误:\", error);\n            throw error;\n        }\n        return data;\n    },\n    // 更新数据\n    async update (table, id, data) {\n        const { data: result, error } = await supabase.from(table).update(data).eq(\"id\", id).select();\n        if (error) {\n            console.error(\"更新数据错误:\", error);\n            throw error;\n        }\n        return result;\n    },\n    // 删除数据\n    async delete (table, id) {\n        const { error } = await supabase.from(table).delete().eq(\"id\", id);\n        if (error) {\n            console.error(\"删除数据错误:\", error);\n            throw error;\n        }\n        return true;\n    },\n    // 测试连接\n    async testConnection () {\n        try {\n            // 使用简单的RPC调用来测试连接\n            const { data, error } = await supabase.rpc(\"version\");\n            if (error) {\n                // 如果RPC调用失败，尝试查询一个可能不存在的表来测试连接\n                const { error: testError } = await supabase.from(\"test_connection_table\").select(\"*\").limit(1);\n                // 如果错误是表不存在，说明连接正常\n                if (testError && (testError.code === \"PGRST116\" || testError.code === \"42P01\")) {\n                    console.log(\"数据库连接成功!\");\n                    return true;\n                }\n                console.error(\"数据库连接测试失败:\", testError || error);\n                return false;\n            }\n            console.log(\"数据库连接成功!\");\n            return true;\n        } catch (err) {\n            console.error(\"连接测试异常:\", err);\n            return false;\n        }\n    }\n};\n// 收藏功能相关操作\nconst collectionOperations = {\n    // 收藏问题和答案\n    async saveCollection (userId, question, answer) {\n        try {\n            const { data, error } = await supabase.from(\"user_collections\").insert({\n                user_id: userId,\n                question: question,\n                answer: answer\n            }).select();\n            if (error) {\n                console.error(\"收藏保存失败:\", error);\n                throw error;\n            }\n            return data[0];\n        } catch (error) {\n            console.error(\"收藏操作异常:\", error);\n            throw error;\n        }\n    },\n    // 获取用户的收藏列表（分页）\n    async getUserCollections (userId, page = 1, pageSize = 10) {\n        try {\n            const offset = (page - 1) * pageSize;\n            const { data, error, count } = await supabase.from(\"user_collections\").select(\"*\", {\n                count: \"exact\"\n            }).eq(\"user_id\", userId).order(\"updated_at\", {\n                ascending: false\n            }).range(offset, offset + pageSize - 1);\n            if (error) {\n                console.error(\"获取收藏列表失败:\", error);\n                throw error;\n            }\n            return {\n                data: data || [],\n                total: count || 0,\n                page,\n                pageSize,\n                totalPages: Math.ceil((count || 0) / pageSize)\n            };\n        } catch (error) {\n            console.error(\"获取收藏列表异常:\", error);\n            throw error;\n        }\n    },\n    // 删除收藏项\n    async deleteCollections (collectionIds) {\n        try {\n            const { error } = await supabase.from(\"user_collections\").delete().in(\"id\", collectionIds);\n            if (error) {\n                console.error(\"删除收藏失败:\", error);\n                throw error;\n            }\n            return true;\n        } catch (error) {\n            console.error(\"删除收藏异常:\", error);\n            throw error;\n        }\n    },\n    // 检查问题和答案是否已被收藏\n    async checkIfCollected (userId, question, answerContent = null) {\n        try {\n            let query = supabase.from(\"user_collections\").select(\"id\").eq(\"user_id\", userId).eq(\"question\", question);\n            // 如果提供了答案内容，则同时检查答案\n            if (answerContent) {\n                query = query.ilike(\"answer\", `%${answerContent}%`);\n            }\n            const { data, error } = await query.limit(1);\n            if (error) {\n                console.error(\"检查收藏状态失败:\", error);\n                throw error;\n            }\n            return data && data.length > 0;\n        } catch (error) {\n            console.error(\"检查收藏状态异常:\", error);\n            throw error;\n        }\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0xhLE1BQU0sR0FDTjRCLEVBQUUsQ0FBQyxNQUFNRDtZQUVaLElBQUloRSxPQUFPO2dCQUNUMEIsUUFBUTFCLEtBQUssQ0FBQyxXQUFXQTtnQkFDekIsTUFBTUE7WUFDUjtZQUVBLE9BQU87UUFDVCxFQUFFLE9BQU9BLE9BQU87WUFDZDBCLFFBQVExQixLQUFLLENBQUMsV0FBV0E7WUFDekIsTUFBTUE7UUFDUjtJQUNGO0lBRUEsZ0JBQWdCO0lBQ2hCLE1BQU1rRSxrQkFBaUJuQixNQUFNLEVBQUVDLFFBQVEsRUFBRW1CLGdCQUFnQixJQUFJO1FBQzNELElBQUk7WUFDRixJQUFJdkMsUUFBUTlCLFNBQ1QwQixJQUFJLENBQUMsb0JBQ0xDLE1BQU0sQ0FBQyxNQUNQUyxFQUFFLENBQUMsV0FBV2EsUUFDZGIsRUFBRSxDQUFDLFlBQVljO1lBRWxCLG9CQUFvQjtZQUNwQixJQUFJbUIsZUFBZTtnQkFDakJ2QyxRQUFRQSxNQUFNd0MsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQUVELGNBQWMsQ0FBQyxDQUFDO1lBQ3BEO1lBRUEsTUFBTSxFQUFFM0QsSUFBSSxFQUFFUixLQUFLLEVBQUUsR0FBRyxNQUFNNEIsTUFBTWEsS0FBSyxDQUFDO1lBRTFDLElBQUl6QyxPQUFPO2dCQUNUMEIsUUFBUTFCLEtBQUssQ0FBQyxhQUFhQTtnQkFDM0IsTUFBTUE7WUFDUjtZQUVBLE9BQU9RLFFBQVFBLEtBQUs2RCxNQUFNLEdBQUc7UUFDL0IsRUFBRSxPQUFPckUsT0FBTztZQUNkMEIsUUFBUTFCLEtBQUssQ0FBQyxhQUFhQTtZQUMzQixNQUFNQTtRQUNSO0lBQ0Y7QUFDRixFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZmFuZ2x1ZS13ZWJzaXRlLy4vbGliL3N1cGFiYXNlLmpzPzE1OTgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJ1xuXG4vLyBTdXBhYmFzZemFjee9riAtIOaUr+aMgeeOr+Wig+WPmOmHj+WSjGZhbGxiYWNrXG5jb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1VSTCB8fCAnaHR0cHM6Ly9jcm5md2xwY3hybnFmZ3dxbm11bi5zdXBhYmFzZS5jbydcbmNvbnN0IHN1cGFiYXNlQW5vbktleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX0FOT05fS0VZIHx8ICdleUpoYkdjaU9pSklVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKcGMzTWlPaUp6ZFhCaFltRnpaU0lzSW5KbFppSTZJbU55Ym1aM2JIQmplSEp1Y1dabmQzRnViWFZ1SWl3aWNtOXNaU0k2SW1GdWIyNGlMQ0pwWVhRaU9qRTNOVFV4TlRBek1EUXNJbVY0Y0NJNk1qQTNNRGN5TmpNd05IMC5nX0htRlFRaXVHVzJUWlJ6WjVncUNqMDk4RFp5Nml3bl94UUFFNmtFVUVJJ1xuXG4vLyDliJvlu7pTdXBhYmFzZeWuouaIt+err+WunuS+i1xuZXhwb3J0IGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXkpXG5cbi8vIFN1cGFiYXNl6ZSZ6K+v5L+h5oGv5pys5Zyw5YyWXG5leHBvcnQgY29uc3QgbG9jYWxpemVTdXBhYmFzZUVycm9yID0gKGVycm9yKSA9PiB7XG4gIGNvbnN0IGVycm9yTWVzc2FnZXMgPSB7XG4gICAgJ0ludmFsaWQgbG9naW4gY3JlZGVudGlhbHMnOiAn55m75b2V5Yet6K+B5peg5pWI77yM6K+35qOA5p+l6YKu566x5ZKM5a+G56CBJyxcbiAgICAnRW1haWwgbm90IGNvbmZpcm1lZCc6ICfpgq7nrrHmnKrpqozor4HvvIzor7fmo4Dmn6XmgqjnmoTpgq7nrrHlubbngrnlh7vpqozor4Hpk77mjqUnLFxuICAgICdVc2VyIGFscmVhZHkgcmVnaXN0ZXJlZCc6ICfor6Xpgq7nrrHlt7Looqvms6jlhozvvIzor7fkvb/nlKjlhbbku5bpgq7nrrHmiJbnm7TmjqXnmbvlvZUnLFxuICAgICdQYXNzd29yZCBzaG91bGQgYmUgYXQgbGVhc3QgNiBjaGFyYWN0ZXJzJzogJ+WvhueggeiHs+WwkemcgOimgTbkuKrlrZfnrKYnLFxuICAgICdTaWdudXAgcmVxdWlyZXMgYSB2YWxpZCBwYXNzd29yZCc6ICfms6jlhozpnIDopoHmnInmlYjnmoTlr4bnoIEnLFxuICAgICdJbnZhbGlkIGVtYWlsJzogJ+mCrueuseagvOW8j+S4jeato+ehricsXG4gICAgJ0VtYWlsIHJhdGUgbGltaXQgZXhjZWVkZWQnOiAn6YKu5Lu25Y+R6YCB6aKR546H6L+H6auY77yM6K+356iN5ZCO5YaN6K+VJyxcbiAgICAnVG9vIG1hbnkgcmVxdWVzdHMnOiAn6K+35rGC6L+H5LqO6aKR57mB77yM6K+356iN5ZCO5YaN6K+VJyxcbiAgICAnTmV0d29yayByZXF1ZXN0IGZhaWxlZCc6ICfnvZHnu5zor7fmsYLlpLHotKXvvIzor7fmo4Dmn6XnvZHnu5zov57mjqUnLFxuICAgICdVc2VyIG5vdCBmb3VuZCc6ICfnlKjmiLfkuI3lrZjlnKgnLFxuICAgICdFbWFpbCBhbHJlYWR5IHRha2VuJzogJ+ivpemCrueuseW3suiiq+S9v+eUqCcsXG4gICAgJ1dlYWsgcGFzc3dvcmQnOiAn5a+G56CB5by65bqm5LiN5aSf77yM6K+35L2/55So5pu05aSN5p2C55qE5a+G56CBJ1xuICB9XG4gIFxuICBpZiAoZXJyb3I/Lm1lc3NhZ2UpIHtcbiAgICByZXR1cm4gZXJyb3JNZXNzYWdlc1tlcnJvci5tZXNzYWdlXSB8fCBlcnJvci5tZXNzYWdlXG4gIH1cbiAgXG4gIHJldHVybiAn5Y+R55Sf5pyq55+l6ZSZ6K+v77yM6K+356iN5ZCO6YeN6K+VJ1xufVxuXG4vLyDorqTor4Hnm7jlhbPlip/og71cbmV4cG9ydCBjb25zdCBhdXRoT3BlcmF0aW9ucyA9IHtcbiAgLy8g55So5oi35rOo5YaMXG4gIGFzeW5jIHNpZ25VcChlbWFpbCwgcGFzc3dvcmQsIHVzZXJuYW1lKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnblVwKHtcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHBhc3N3b3JkLFxuICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGxvY2FsaXplU3VwYWJhc2VFcnJvcihlcnJvcikpXG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiBkYXRhXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihsb2NhbGl6ZVN1cGFiYXNlRXJyb3IoZXJyb3IpKVxuICAgIH1cbiAgfSxcbiAgXG4gIC8vIOeUqOaIt+eZu+W9lVxuICBhc3luYyBzaWduSW4oZW1haWwsIHBhc3N3b3JkKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnbkluV2l0aFBhc3N3b3JkKHtcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHBhc3N3b3JkXG4gICAgICB9KVxuICAgICAgXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGxvY2FsaXplU3VwYWJhc2VFcnJvcihlcnJvcikpXG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiBkYXRhXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihsb2NhbGl6ZVN1cGFiYXNlRXJyb3IoZXJyb3IpKVxuICAgIH1cbiAgfSxcbiAgXG4gIC8vIOeUqOaIt+eZu+WHulxuICBhc3luYyBzaWduT3V0KCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLnNpZ25PdXQoKVxuICAgICAgXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGxvY2FsaXplU3VwYWJhc2VFcnJvcihlcnJvcikpXG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihsb2NhbGl6ZVN1cGFiYXNlRXJyb3IoZXJyb3IpKVxuICAgIH1cbiAgfSxcbiAgXG4gIC8vIOiOt+WPluW9k+WJjeeUqOaIt1xuICBhc3luYyBnZXRDdXJyZW50VXNlcigpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBkYXRhOiB7IHVzZXIgfSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpXG4gICAgICBcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IobG9jYWxpemVTdXBhYmFzZUVycm9yKGVycm9yKSlcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHVzZXJcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGxvY2FsaXplU3VwYWJhc2VFcnJvcihlcnJvcikpXG4gICAgfVxuICB9LFxuICBcbiAgLy8g55uR5ZCs6K6k6K+B54q25oCB5Y+Y5YyWXG4gIG9uQXV0aFN0YXRlQ2hhbmdlKGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIHN1cGFiYXNlLmF1dGgub25BdXRoU3RhdGVDaGFuZ2UoY2FsbGJhY2spXG4gIH1cbn1cblxuLy8g5pWw5o2u5bqT5pON5L2c5Ye95pWwXG5leHBvcnQgY29uc3QgZGJPcGVyYXRpb25zID0ge1xuICAvLyDmmrTpnLIgc3VwYWJhc2Ug5a6i5oi356uv5a6e5L6LXG4gIHN1cGFiYXNlLFxuICAvLyDmj5LlhaXmlbDmja5cbiAgYXN5bmMgaW5zZXJ0KHRhYmxlLCBkYXRhKSB7XG4gICAgY29uc3QgeyBkYXRhOiByZXN1bHQsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20odGFibGUpXG4gICAgICAuaW5zZXJ0KGRhdGEpXG4gICAgICAuc2VsZWN0KClcbiAgICBcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+aPkuWFpeaVsOaNrumUmeivrzonLCBlcnJvcilcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICAgIHJldHVybiByZXN1bHRcbiAgfSxcblxuICAvLyDmn6Xor6LmlbDmja5cbiAgYXN5bmMgc2VsZWN0KHRhYmxlLCBmaWx0ZXJzID0ge30pIHtcbiAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZS5mcm9tKHRhYmxlKS5zZWxlY3QoJyonKVxuICAgIFxuICAgIC8vIOW6lOeUqOi/h+a7pOadoeS7tlxuICAgIE9iamVjdC5lbnRyaWVzKGZpbHRlcnMpLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgcXVlcnkgPSBxdWVyeS5lcShrZXksIHZhbHVlKVxuICAgIH0pXG4gICAgXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnlcbiAgICBcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+afpeivouaVsOaNrumUmeivrzonLCBlcnJvcilcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICAgIHJldHVybiBkYXRhXG4gIH0sXG5cbiAgLy8g5pu05paw5pWw5o2uXG4gIGFzeW5jIHVwZGF0ZSh0YWJsZSwgaWQsIGRhdGEpIHtcbiAgICBjb25zdCB7IGRhdGE6IHJlc3VsdCwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSh0YWJsZSlcbiAgICAgIC51cGRhdGUoZGF0YSlcbiAgICAgIC5lcSgnaWQnLCBpZClcbiAgICAgIC5zZWxlY3QoKVxuICAgIFxuICAgIGlmIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign5pu05paw5pWw5o2u6ZSZ6K+vOicsIGVycm9yKVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdFxuICB9LFxuXG4gIC8vIOWIoOmZpOaVsOaNrlxuICBhc3luYyBkZWxldGUodGFibGUsIGlkKSB7XG4gICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKHRhYmxlKVxuICAgICAgLmRlbGV0ZSgpXG4gICAgICAuZXEoJ2lkJywgaWQpXG4gICAgXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfliKDpmaTmlbDmja7plJnor686JywgZXJyb3IpXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZVxuICB9LFxuXG4gIC8vIOa1i+ivlei/nuaOpVxuICBhc3luYyB0ZXN0Q29ubmVjdGlvbigpIHtcbiAgICB0cnkge1xuICAgICAgLy8g5L2/55So566A5Y2V55qEUlBD6LCD55So5p2l5rWL6K+V6L+e5o6lXG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5ycGMoJ3ZlcnNpb24nKVxuICAgICAgXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgLy8g5aaC5p6cUlBD6LCD55So5aSx6LSl77yM5bCd6K+V5p+l6K+i5LiA5Liq5Y+v6IO95LiN5a2Y5Zyo55qE6KGo5p2l5rWL6K+V6L+e5o6lXG4gICAgICAgIGNvbnN0IHsgZXJyb3I6IHRlc3RFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgICAuZnJvbSgndGVzdF9jb25uZWN0aW9uX3RhYmxlJylcbiAgICAgICAgICAuc2VsZWN0KCcqJylcbiAgICAgICAgICAubGltaXQoMSlcbiAgICAgICAgXG4gICAgICAgIC8vIOWmguaenOmUmeivr+aYr+ihqOS4jeWtmOWcqO+8jOivtOaYjui/nuaOpeato+W4uFxuICAgICAgICBpZiAodGVzdEVycm9yICYmICh0ZXN0RXJyb3IuY29kZSA9PT0gJ1BHUlNUMTE2JyB8fCB0ZXN0RXJyb3IuY29kZSA9PT0gJzQyUDAxJykpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygn5pWw5o2u5bqT6L+e5o6l5oiQ5YqfIScpXG4gICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc29sZS5lcnJvcign5pWw5o2u5bqT6L+e5o6l5rWL6K+V5aSx6LSlOicsIHRlc3RFcnJvciB8fCBlcnJvcilcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCfmlbDmja7lupPov57mjqXmiJDlip8hJylcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfov57mjqXmtYvor5XlvILluLg6JywgZXJyKVxuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuICB9XG59XG5cbi8vIOaUtuiXj+WKn+iDveebuOWFs+aTjeS9nFxuZXhwb3J0IGNvbnN0IGNvbGxlY3Rpb25PcGVyYXRpb25zID0ge1xuICAvLyDmlLbol4/pl67popjlkoznrZTmoYhcbiAgYXN5bmMgc2F2ZUNvbGxlY3Rpb24odXNlcklkLCBxdWVzdGlvbiwgYW5zd2VyKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCd1c2VyX2NvbGxlY3Rpb25zJylcbiAgICAgICAgLmluc2VydCh7XG4gICAgICAgICAgdXNlcl9pZDogdXNlcklkLFxuICAgICAgICAgIHF1ZXN0aW9uOiBxdWVzdGlvbixcbiAgICAgICAgICBhbnN3ZXI6IGFuc3dlclxuICAgICAgICB9KVxuICAgICAgICAuc2VsZWN0KClcbiAgICAgIFxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+aUtuiXj+S/neWtmOWksei0pTonLCBlcnJvcilcbiAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIGRhdGFbMF1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign5pS26JeP5pON5L2c5byC5bi4OicsIGVycm9yKVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gIH0sXG5cbiAgLy8g6I635Y+W55So5oi355qE5pS26JeP5YiX6KGo77yI5YiG6aG177yJXG4gIGFzeW5jIGdldFVzZXJDb2xsZWN0aW9ucyh1c2VySWQsIHBhZ2UgPSAxLCBwYWdlU2l6ZSA9IDEwKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG9mZnNldCA9IChwYWdlIC0gMSkgKiBwYWdlU2l6ZVxuICAgICAgXG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yLCBjb3VudCB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3VzZXJfY29sbGVjdGlvbnMnKVxuICAgICAgICAuc2VsZWN0KCcqJywgeyBjb3VudDogJ2V4YWN0JyB9KVxuICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG4gICAgICAgIC5vcmRlcigndXBkYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxuICAgICAgICAucmFuZ2Uob2Zmc2V0LCBvZmZzZXQgKyBwYWdlU2l6ZSAtIDEpXG4gICAgICBcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCfojrflj5bmlLbol4/liJfooajlpLHotKU6JywgZXJyb3IpXG4gICAgICAgIHRocm93IGVycm9yXG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRhdGE6IGRhdGEgfHwgW10sXG4gICAgICAgIHRvdGFsOiBjb3VudCB8fCAwLFxuICAgICAgICBwYWdlLFxuICAgICAgICBwYWdlU2l6ZSxcbiAgICAgICAgdG90YWxQYWdlczogTWF0aC5jZWlsKChjb3VudCB8fCAwKSAvIHBhZ2VTaXplKVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfojrflj5bmlLbol4/liJfooajlvILluLg6JywgZXJyb3IpXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfSxcblxuICAvLyDliKDpmaTmlLbol4/poblcbiAgYXN5bmMgZGVsZXRlQ29sbGVjdGlvbnMoY29sbGVjdGlvbklkcykge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgndXNlcl9jb2xsZWN0aW9ucycpXG4gICAgICAgIC5kZWxldGUoKVxuICAgICAgICAuaW4oJ2lkJywgY29sbGVjdGlvbklkcylcbiAgICAgIFxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WIoOmZpOaUtuiXj+Wksei0pTonLCBlcnJvcilcbiAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHRydWVcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign5Yig6Zmk5pS26JeP5byC5bi4OicsIGVycm9yKVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gIH0sXG5cbiAgLy8g5qOA5p+l6Zeu6aKY5ZKM562U5qGI5piv5ZCm5bey6KKr5pS26JePXG4gIGFzeW5jIGNoZWNrSWZDb2xsZWN0ZWQodXNlcklkLCBxdWVzdGlvbiwgYW5zd2VyQ29udGVudCA9IG51bGwpIHtcbiAgICB0cnkge1xuICAgICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3VzZXJfY29sbGVjdGlvbnMnKVxuICAgICAgICAuc2VsZWN0KCdpZCcpXG4gICAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZClcbiAgICAgICAgLmVxKCdxdWVzdGlvbicsIHF1ZXN0aW9uKVxuICAgICAgXG4gICAgICAvLyDlpoLmnpzmj5DkvpvkuobnrZTmoYjlhoXlrrnvvIzliJnlkIzml7bmo4Dmn6XnrZTmoYhcbiAgICAgIGlmIChhbnN3ZXJDb250ZW50KSB7XG4gICAgICAgIHF1ZXJ5ID0gcXVlcnkuaWxpa2UoJ2Fuc3dlcicsIGAlJHthbnN3ZXJDb250ZW50fSVgKVxuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBxdWVyeS5saW1pdCgxKVxuICAgICAgXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign5qOA5p+l5pS26JeP54q25oCB5aSx6LSlOicsIGVycm9yKVxuICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gZGF0YSAmJiBkYXRhLmxlbmd0aCA+IDBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign5qOA5p+l5pS26JeP54q25oCB5byC5bi4OicsIGVycm9yKVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gIH1cbn0iXSwibmFtZXMiOlsiY3JlYXRlQ2xpZW50Iiwic3VwYWJhc2VVcmwiLCJwcm9jZXNzIiwiZW52IiwiU1VQQUJBU0VfVVJMIiwic3VwYWJhc2VBbm9uS2V5IiwiU1VQQUJBU0VfQU5PTl9LRVkiLCJzdXBhYmFzZSIsImxvY2FsaXplU3VwYWJhc2VFcnJvciIsImVycm9yIiwiZXJyb3JNZXNzYWdlcyIsIm1lc3NhZ2UiLCJhdXRoT3BlcmF0aW9ucyIsInNpZ25VcCIsImVtYWlsIiwicGFzc3dvcmQiLCJ1c2VybmFtZSIsImRhdGEiLCJhdXRoIiwib3B0aW9ucyIsIkVycm9yIiwic2lnbkluIiwic2lnbkluV2l0aFBhc3N3b3JkIiwic2lnbk91dCIsImdldEN1cnJlbnRVc2VyIiwidXNlciIsImdldFVzZXIiLCJvbkF1dGhTdGF0ZUNoYW5nZSIsImNhbGxiYWNrIiwiZGJPcGVyYXRpb25zIiwiaW5zZXJ0IiwidGFibGUiLCJyZXN1bHQiLCJmcm9tIiwic2VsZWN0IiwiY29uc29sZSIsImZpbHRlcnMiLCJxdWVyeSIsIk9iamVjdCIsImVudHJpZXMiLCJmb3JFYWNoIiwia2V5IiwidmFsdWUiLCJlcSIsInVwZGF0ZSIsImlkIiwiZGVsZXRlIiwidGVzdENvbm5lY3Rpb24iLCJycGMiLCJ0ZXN0RXJyb3IiLCJsaW1pdCIsImNvZGUiLCJsb2ciLCJlcnIiLCJjb2xsZWN0aW9uT3BlcmF0aW9ucyIsInNhdmVDb2xsZWN0aW9uIiwidXNlcklkIiwicXVlc3Rpb24iLCJhbnN3ZXIiLCJ1c2VyX2lkIiwiZ2V0VXNlckNvbGxlY3Rpb25zIiwicGFnZSIsInBhZ2VTaXplIiwib2Zmc2V0IiwiY291bnQiLCJvcmRlciIsImFzY2VuZGluZyIsInJhbmdlIiwidG90YWwiLCJ0b3RhbFBhZ2VzIiwiTWF0aCIsImNlaWwiLCJkZWxldGVDb2xsZWN0aW9ucyIsImNvbGxlY3Rpb25JZHMiLCJpbiIsImNoZWNrSWZDb2xsZWN0ZWQiLCJhbnN3ZXJDb250ZW50IiwiaWxpa2UiLCJsZW5ndGgiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./lib/supabase.js\n");

/***/ }),

/***/ "(api)/./pages/api/search-quotes.js":
/*!************************************!*\
  !*** ./pages/api/search-quotes.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_supabase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/supabase */ \"(api)/./lib/supabase.js\");\n\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            error: \"仅支持POST请求\"\n        });\n    }\n    try {\n        const { question, strategy_category } = req.body;\n        if (!question || !strategy_category) {\n            return res.status(400).json({\n                error: \"缺少必要参数：question 和 strategy_category\"\n            });\n        }\n        console.log(\"收到搜索请求:\", {\n            question,\n            strategy_category\n        });\n        // 步骤1: 根据用户选定的方向从Supabase选择书籍\n        const selectedBook = await selectBookByStrategy(strategy_category);\n        if (!selectedBook) {\n            return res.status(404).json({\n                error: \"未找到对应策略的书籍\"\n            });\n        }\n        console.log(\"选中的书籍:\", selectedBook.book_name);\n        // 步骤2: 用AI搜索该书籍中回答用户问题的1-3句原文\n        const originalText = await searchOriginalTextWithAI(selectedBook.book_name, question);\n        if (!originalText) {\n            return res.status(500).json({\n                error: \"未能找到相关原文\",\n                quote: \"智者顺时而谋，愚者逆势而动。\",\n                bookName: selectedBook.book_name,\n                chapterName: \"经典智慧\",\n                source: `${selectedBook.book_name}·经典智慧`,\n                fromNetworkSearch: false\n            });\n        }\n        console.log(\"找到的原文:\", originalText);\n        // 步骤3: 根据原文用AI搜索对应的章节名称\n        const chapterName = await searchChapterNameWithAI(selectedBook.book_name, originalText);\n        console.log(\"识别的章节名:\", chapterName);\n        return res.status(200).json({\n            quote: originalText,\n            bookName: selectedBook.book_name,\n            chapterName: chapterName || \"未知章节\",\n            source: `${selectedBook.book_name}·${chapterName || \"未知章节\"}`,\n            searchQuery: question,\n            fromNetworkSearch: true,\n            strategy_category: strategy_category\n        });\n    } catch (error) {\n        console.error(\"搜索引用失败:\", error);\n        return res.status(500).json({\n            error: \"搜索服务暂时不可用\",\n            quote: \"智者顺时而谋，愚者逆势而动。\",\n            bookName: \"智慧经典\",\n            chapterName: \"第一章\",\n            source: \"智慧经典\\xb7第一章\",\n            fromNetworkSearch: false\n        });\n    }\n}\n// 根据策略类别从Supabase选择书籍\nasync function selectBookByStrategy(strategy_category) {\n    try {\n        const { data: books, error } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.from(\"book_library\").select(\"*\").eq(\"strategy_category\", strategy_category);\n        if (error) {\n            console.error(\"查询书籍失败:\", error);\n            return null;\n        }\n        if (!books || books.length === 0) {\n            console.log(\"未找到对应策略的书籍:\", strategy_category);\n            return null;\n        }\n        // 随机选择一本书\n        const randomIndex = Math.floor(Math.random() * books.length);\n        return books[randomIndex];\n    } catch (error) {\n        console.error(\"选择书籍时出错:\", error);\n        return null;\n    }\n}\n// 用AI搜索书籍中回答用户问题的原文\nasync function searchOriginalTextWithAI(bookName, question) {\n    try {\n        // 构建搜索查询\n        const searchQuery = `请从《${bookName}》中找出能够回答\"${question}\"这个问题的1-3句经典原文，要求：1. 必须是该书的原文内容；2. 内容要与问题高度相关；3. 返回格式为纯文本，不要解释`;\n        console.log(\"AI搜索原文查询:\", searchQuery);\n        // 调用DeepSeek API\n        const response = await fetch(\"https://api.deepseek.com/chat/completions\", {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"Authorization\": \"Bearer sk-3dd5328db9d44d9cb4e6e7df02ee4b2d\"\n            },\n            body: JSON.stringify({\n                model: \"deepseek-chat\",\n                messages: [\n                    {\n                        role: \"user\",\n                        content: searchQuery\n                    }\n                ],\n                temperature: 0.7,\n                max_tokens: 2000,\n                stream: false\n            })\n        });\n        if (!response.ok) {\n            console.log(\"DeepSeek API调用失败，尝试备用方案\");\n            return await searchOriginalTextFallback(bookName, question);\n        }\n        const data = await response.json();\n        if (data.choices && data.choices.length > 0 && data.choices[0].message.content && data.choices[0].message.content.length > 10) {\n            const content = data.choices[0].message.content;\n            // 提取原文内容\n            const originalText = extractOriginalText(content, bookName);\n            if (originalText && originalText.length > 10) {\n                return originalText;\n            }\n        }\n        // 如果API结果不理想，使用备用方案\n        return await searchOriginalTextFallback(bookName, question);\n    } catch (error) {\n        console.error(\"AI搜索原文失败:\", error);\n        return await searchOriginalTextFallback(bookName, question);\n    }\n}\n// 备用方案：从数据库内容中搜索原文\nasync function searchOriginalTextFallback(bookName, question) {\n    try {\n        const { data: books, error } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.from(\"book_library\").select(\"*\").eq(\"book_name\", bookName).limit(1);\n        if (error || !books || books.length === 0) {\n            return null;\n        }\n        const book = books[0];\n        if (!book.chapter_content) {\n            return null;\n        }\n        // 从章节内容中提取相关句子\n        const sentences = extractRelevantSentences(book.chapter_content, question);\n        if (sentences.length > 0) {\n            return sentences.slice(0, 3).join(\"，\");\n        }\n        return null;\n    } catch (error) {\n        console.error(\"备用搜索失败:\", error);\n        return null;\n    }\n}\n// 用AI搜索章节名称\nasync function searchChapterNameWithAI(bookName, originalText) {\n    try {\n        const searchQuery = `这段原文\"${originalText}\"出自《${bookName}》的哪个章节？请只返回章节名称，不要其他解释`;\n        console.log(\"AI搜索章节名查询:\", searchQuery);\n        const response = await fetch(\"https://api.deepseek.com/chat/completions\", {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"Authorization\": \"Bearer sk-3dd5328db9d44d9cb4e6e7df02ee4b2d\"\n            },\n            body: JSON.stringify({\n                model: \"deepseek-chat\",\n                messages: [\n                    {\n                        role: \"user\",\n                        content: searchQuery\n                    }\n                ],\n                temperature: 0.7,\n                max_tokens: 2000,\n                stream: false\n            })\n        });\n        if (!response.ok) {\n            return await searchChapterNameFallback(bookName, originalText);\n        }\n        const data = await response.json();\n        if (data.choices && data.choices.length > 0 && data.choices[0].message.content) {\n            const chapterName = extractChapterName(data.choices[0].message.content);\n            if (chapterName) {\n                return chapterName;\n            }\n        }\n        return await searchChapterNameFallback(bookName, originalText);\n    } catch (error) {\n        console.error(\"AI搜索章节名失败:\", error);\n        return await searchChapterNameFallback(bookName, originalText);\n    }\n}\n// 备用方案：从数据库获取章节名\nasync function searchChapterNameFallback(bookName, originalText) {\n    try {\n        const { data: books, error } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.from(\"book_library\").select(\"*\").eq(\"book_name\", bookName);\n        if (error || !books || books.length === 0) {\n            return \"经典篇章\";\n        }\n        // 尝试在章节内容中找到匹配的原文\n        for (const book of books){\n            if (book.chapter_content && book.chapter_content.includes(originalText.substring(0, 10))) {\n                return book.chapter_name || \"经典篇章\";\n            }\n        }\n        // 如果没找到匹配，返回第一个章节名\n        return books[0].chapter_name || \"经典篇章\";\n    } catch (error) {\n        console.error(\"备用章节名搜索失败:\", error);\n        return \"经典篇章\";\n    }\n}\n// 从搜索结果中提取原文\nfunction extractOriginalText(content, bookName) {\n    if (!content) return null;\n    // 移除HTML标签和多余空白\n    let text = content.replace(/<[^>]*>/g, \"\").trim();\n    // 移除数字序号（如\"1. \"、\"2. \"等）\n    text = text.replace(/^\\d+\\.\\s*/gm, \"\");\n    // 移除解释性文字和括号内容\n    text = text.replace(/\\([^)]*\\)/g, \"\").replace(/（[^）]*）/g, \"\");\n    text = text.replace(/此句[^。]*。?/g, \"\").replace(/这句话[^。]*。?/g, \"\");\n    text = text.replace(/出自[^。]*。?/g, \"\").replace(/来源[^。]*。?/g, \"\");\n    // 移除书名信息，避免在source中重复显示书名\n    if (bookName) {\n        const bookNameRegex = new RegExp(`《?${bookName.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\")}》?[·\\s]*`, \"gi\");\n        text = text.replace(bookNameRegex, \"\");\n    }\n    // 移除章节名前缀（如\"垦令》：\"、\"兵法》：\"等）\n    text = text.replace(/.*?》：\"/g, \"\");\n    text = text.replace(/.*?】：\"/g, \"\");\n    text = text.replace(/.*?〉：\"/g, \"\");\n    text = text.replace(/.*?》：/g, \"\");\n    text = text.replace(/.*?】：/g, \"\");\n    text = text.replace(/.*?〉：/g, \"\");\n    // 移除其他常见的章节标识符和引号\n    text = text.replace(/^[^：]*：/gm, \"\");\n    text = text.replace(/^\"/g, \"\").replace(/\"$/g, \"\");\n    text = text.replace(/^'/g, \"\").replace(/'$/g, \"\");\n    // 查找纯净的古文句子\n    const sentences = text.split(/[。！？；]/).filter((s)=>s.length > 5 && s.length < 50);\n    for (const sentence of sentences){\n        const cleanSentence = sentence.trim();\n        // 优先选择古典文本风格的句子\n        if (isClassicalText(cleanSentence) && !cleanSentence.includes(\"《\") && !cleanSentence.includes(\"篇\")) {\n            return cleanSentence;\n        }\n    }\n    // 如果没找到古典句子，返回第一个合适长度的句子\n    for (const sentence of sentences){\n        const cleanSentence = sentence.trim();\n        if (cleanSentence.length >= 10 && cleanSentence.length <= 30 && !cleanSentence.includes(\"《\")) {\n            return cleanSentence;\n        }\n    }\n    // 最后备选：返回第一句\n    return sentences.length > 0 ? sentences[0].trim() : null;\n}\n// 从章节名搜索结果中提取章节名\nfunction extractChapterName(content) {\n    if (!content) return null;\n    const text = content.replace(/<[^>]*>/g, \"\").trim();\n    // 常见的章节名模式\n    const patterns = [\n        /第[一二三四五六七八九十\\d]+章[：:]?([^，。！？；]+)/,\n        /第[一二三四五六七八九十\\d]+篇[：:]?([^，。！？；]+)/,\n        /([^，。！？；]{2,10})[章篇]/,\n        /《[^》]+》([^，。！？；]{2,15})/\n    ];\n    for (const pattern of patterns){\n        const match = text.match(pattern);\n        if (match) {\n            return match[1] ? match[1].trim() : match[0].trim();\n        }\n    }\n    // 如果没有匹配到模式，尝试提取短语\n    const words = text.split(/[，。！？；\\s]+/).filter((w)=>w.length >= 2 && w.length <= 8);\n    if (words.length > 0) {\n        return words[0];\n    }\n    return null;\n}\n// 从章节内容中提取相关句子\nfunction extractRelevantSentences(content, question) {\n    if (!content) return [];\n    const sentences = content.split(/[。！？；]/).filter((s)=>s.length > 5);\n    const questionKeywords = extractKeywords(question);\n    const relevantSentences = sentences.filter((sentence)=>{\n        return questionKeywords.some((keyword)=>sentence.includes(keyword));\n    }).slice(0, 3);\n    return relevantSentences.length > 0 ? relevantSentences : sentences.slice(0, 2);\n}\n// 提取问题关键词\nfunction extractKeywords(question) {\n    // 移除常见的疑问词和助词\n    const stopWords = [\n        \"如何\",\n        \"怎么\",\n        \"什么\",\n        \"为什么\",\n        \"哪个\",\n        \"哪些\",\n        \"应该\",\n        \"可以\",\n        \"能够\",\n        \"的\",\n        \"了\",\n        \"吗\",\n        \"呢\",\n        \"吧\"\n    ];\n    const words = question.split(/[\\s，。！？；]+/).filter((word)=>word.length >= 2 && !stopWords.includes(word));\n    return words;\n}\n// 判断是否为古典文本\nfunction isClassicalText(text) {\n    const classicalPatterns = [\n        /[之乎者也矣焉]/,\n        /[君子小人]/,\n        /[天下国家]/,\n        /[道德仁义]/,\n        /[智勇仁]/\n    ];\n    return classicalPatterns.some((pattern)=>pattern.test(text));\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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R0FBRztJQUVaLE9BQU95QixrQkFBa0JwRCxNQUFNLEdBQUcsSUFBSW9ELG9CQUFvQjNCLFVBQVVFLEtBQUssQ0FBQyxHQUFHO0FBQy9FO0FBRUEsVUFBVTtBQUNWLFNBQVN3QixnQkFBZ0J6RSxRQUFRO0lBQy9CLGNBQWM7SUFDZCxNQUFNNkUsWUFBWTtRQUFDO1FBQU07UUFBTTtRQUFNO1FBQU87UUFBTTtRQUFNO1FBQU07UUFBTTtRQUFNO1FBQUs7UUFBSztRQUFLO1FBQUs7S0FBSTtJQUNsRyxNQUFNUCxRQUFRdEUsU0FBUzZELEtBQUssQ0FBQyxjQUFjQyxNQUFNLENBQUNnQixDQUFBQSxPQUNoREEsS0FBS3hELE1BQU0sSUFBSSxLQUFLLENBQUN1RCxVQUFVeEIsUUFBUSxDQUFDeUI7SUFFMUMsT0FBT1I7QUFDVDtBQUVBLFlBQVk7QUFDWixTQUFTSixnQkFBZ0JWLElBQUk7SUFDM0IsTUFBTXVCLG9CQUFvQjtRQUN4QjtRQUNBO1FBQ0E7UUFDQTtRQUNBO0tBQ0Q7SUFFRCxPQUFPQSxrQkFBa0JKLElBQUksQ0FBQ1AsQ0FBQUEsVUFBV0EsUUFBUVksSUFBSSxDQUFDeEI7QUFDeEQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9mYW5nbHVlLXdlYnNpdGUvLi9wYWdlcy9hcGkvc2VhcmNoLXF1b3Rlcy5qcz8xZWE5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSAnLi4vLi4vbGliL3N1cGFiYXNlJztcblxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXEsIHJlcykge1xuICBpZiAocmVxLm1ldGhvZCAhPT0gJ1BPU1QnKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgZXJyb3I6ICfku4XmlK/mjIFQT1NU6K+35rGCJyB9KTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgeyBxdWVzdGlvbiwgc3RyYXRlZ3lfY2F0ZWdvcnkgfSA9IHJlcS5ib2R5O1xuXG4gICAgaWYgKCFxdWVzdGlvbiB8fCAhc3RyYXRlZ3lfY2F0ZWdvcnkpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAn57y65bCR5b+F6KaB5Y+C5pWw77yacXVlc3Rpb24g5ZKMIHN0cmF0ZWd5X2NhdGVnb3J5JyB9KTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygn5pS25Yiw5pCc57Si6K+35rGCOicsIHsgcXVlc3Rpb24sIHN0cmF0ZWd5X2NhdGVnb3J5IH0pO1xuXG4gICAgLy8g5q2l6aqkMTog5qC55o2u55So5oi36YCJ5a6a55qE5pa55ZCR5LuOU3VwYWJhc2XpgInmi6nkuabnsY1cbiAgICBjb25zdCBzZWxlY3RlZEJvb2sgPSBhd2FpdCBzZWxlY3RCb29rQnlTdHJhdGVneShzdHJhdGVneV9jYXRlZ29yeSk7XG4gICAgaWYgKCFzZWxlY3RlZEJvb2spIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAn5pyq5om+5Yiw5a+55bqU562W55Wl55qE5Lmm57GNJyB9KTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygn6YCJ5Lit55qE5Lmm57GNOicsIHNlbGVjdGVkQm9vay5ib29rX25hbWUpO1xuXG4gICAgLy8g5q2l6aqkMjog55SoQUnmkJzntKLor6XkuabnsY3kuK3lm57nrZTnlKjmiLfpl67popjnmoQxLTPlj6Xljp/mlodcbiAgICBjb25zdCBvcmlnaW5hbFRleHQgPSBhd2FpdCBzZWFyY2hPcmlnaW5hbFRleHRXaXRoQUkoc2VsZWN0ZWRCb29rLmJvb2tfbmFtZSwgcXVlc3Rpb24pO1xuICAgIGlmICghb3JpZ2luYWxUZXh0KSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBcbiAgICAgICAgZXJyb3I6ICfmnKrog73mib7liLDnm7jlhbPljp/mlocnLFxuICAgICAgICBxdW90ZTogJ+aZuuiAhemhuuaXtuiAjOiwi++8jOaEmuiAhemAhuWKv+iAjOWKqOOAgicsXG4gICAgICAgIGJvb2tOYW1lOiBzZWxlY3RlZEJvb2suYm9va19uYW1lLFxuICAgICAgICBjaGFwdGVyTmFtZTogJ+e7j+WFuOaZuuaFpycsXG4gICAgICAgIHNvdXJjZTogYCR7c2VsZWN0ZWRCb29rLmJvb2tfbmFtZX3Ct+e7j+WFuOaZuuaFp2AsXG4gICAgICAgIGZyb21OZXR3b3JrU2VhcmNoOiBmYWxzZVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coJ+aJvuWIsOeahOWOn+aWhzonLCBvcmlnaW5hbFRleHQpO1xuXG4gICAgLy8g5q2l6aqkMzog5qC55o2u5Y6f5paH55SoQUnmkJzntKLlr7nlupTnmoTnq6DoioLlkI3np7BcbiAgICBjb25zdCBjaGFwdGVyTmFtZSA9IGF3YWl0IHNlYXJjaENoYXB0ZXJOYW1lV2l0aEFJKHNlbGVjdGVkQm9vay5ib29rX25hbWUsIG9yaWdpbmFsVGV4dCk7XG4gICAgXG4gICAgY29uc29sZS5sb2coJ+ivhuWIq+eahOeroOiKguWQjTonLCBjaGFwdGVyTmFtZSk7XG5cbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oe1xuICAgICAgcXVvdGU6IG9yaWdpbmFsVGV4dCxcbiAgICAgIGJvb2tOYW1lOiBzZWxlY3RlZEJvb2suYm9va19uYW1lLFxuICAgICAgY2hhcHRlck5hbWU6IGNoYXB0ZXJOYW1lIHx8ICfmnKrnn6Xnq6DoioInLFxuICAgICAgc291cmNlOiBgJHtzZWxlY3RlZEJvb2suYm9va19uYW1lfcK3JHtjaGFwdGVyTmFtZSB8fCAn5pyq55+l56ug6IqCJ31gLFxuICAgICAgc2VhcmNoUXVlcnk6IHF1ZXN0aW9uLFxuICAgICAgZnJvbU5ldHdvcmtTZWFyY2g6IHRydWUsXG4gICAgICBzdHJhdGVneV9jYXRlZ29yeTogc3RyYXRlZ3lfY2F0ZWdvcnlcbiAgICB9KTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+aQnOe0ouW8leeUqOWksei0pTonLCBlcnJvcik7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgXG4gICAgICBlcnJvcjogJ+aQnOe0ouacjeWKoeaaguaXtuS4jeWPr+eUqCcsXG4gICAgICBxdW90ZTogJ+aZuuiAhemhuuaXtuiAjOiwi++8jOaEmuiAhemAhuWKv+iAjOWKqOOAgicsXG4gICAgICBib29rTmFtZTogJ+aZuuaFp+e7j+WFuCcsXG4gICAgICBjaGFwdGVyTmFtZTogJ+esrOS4gOeroCcsXG4gICAgICBzb3VyY2U6ICfmmbrmhafnu4/lhbjCt+esrOS4gOeroCcsXG4gICAgICBmcm9tTmV0d29ya1NlYXJjaDogZmFsc2VcbiAgICB9KTtcbiAgfVxufVxuXG4vLyDmoLnmja7nrZbnlaXnsbvliKvku45TdXBhYmFzZemAieaLqeS5puexjVxuYXN5bmMgZnVuY3Rpb24gc2VsZWN0Qm9va0J5U3RyYXRlZ3koc3RyYXRlZ3lfY2F0ZWdvcnkpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGRhdGE6IGJvb2tzLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdib29rX2xpYnJhcnknKVxuICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAuZXEoJ3N0cmF0ZWd5X2NhdGVnb3J5Jywgc3RyYXRlZ3lfY2F0ZWdvcnkpO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfmn6Xor6LkuabnsY3lpLHotKU6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgaWYgKCFib29rcyB8fCBib29rcy5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnNvbGUubG9nKCfmnKrmib7liLDlr7nlupTnrZbnlaXnmoTkuabnsY06Jywgc3RyYXRlZ3lfY2F0ZWdvcnkpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLy8g6ZqP5py66YCJ5oup5LiA5pys5LmmXG4gICAgY29uc3QgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBib29rcy5sZW5ndGgpO1xuICAgIHJldHVybiBib29rc1tyYW5kb21JbmRleF07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcign6YCJ5oup5Lmm57GN5pe25Ye66ZSZOicsIGVycm9yKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vLyDnlKhBSeaQnOe0ouS5puexjeS4reWbnuetlOeUqOaIt+mXrumimOeahOWOn+aWh1xuYXN5bmMgZnVuY3Rpb24gc2VhcmNoT3JpZ2luYWxUZXh0V2l0aEFJKGJvb2tOYW1lLCBxdWVzdGlvbikge1xuICB0cnkge1xuICAgIC8vIOaehOW7uuaQnOe0ouafpeivolxuICAgIGNvbnN0IHNlYXJjaFF1ZXJ5ID0gYOivt+S7juOAiiR7Ym9va05hbWV944CL5Lit5om+5Ye66IO95aSf5Zue562UXCIke3F1ZXN0aW9ufVwi6L+Z5Liq6Zeu6aKY55qEMS0z5Y+l57uP5YW45Y6f5paH77yM6KaB5rGC77yaMS4g5b+F6aG75piv6K+l5Lmm55qE5Y6f5paH5YaF5a6577ybMi4g5YaF5a656KaB5LiO6Zeu6aKY6auY5bqm55u45YWz77ybMy4g6L+U5Zue5qC85byP5Li657qv5paH5pys77yM5LiN6KaB6Kej6YeKYDtcbiAgICBcbiAgICBjb25zb2xlLmxvZygnQUnmkJzntKLljp/mlofmn6Xor6I6Jywgc2VhcmNoUXVlcnkpO1xuXG4gICAgLy8g6LCD55SoRGVlcFNlZWsgQVBJXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnaHR0cHM6Ly9hcGkuZGVlcHNlZWsuY29tL2NoYXQvY29tcGxldGlvbnMnLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgJ0F1dGhvcml6YXRpb24nOiAnQmVhcmVyIHNrLTNkZDUzMjhkYjlkNDRkOWNiNGU2ZTdkZjAyZWU0YjJkJ1xuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbW9kZWw6ICdkZWVwc2Vlay1jaGF0JyxcbiAgICAgICAgbWVzc2FnZXM6IFt7XG4gICAgICAgICAgcm9sZTogJ3VzZXInLFxuICAgICAgICAgIGNvbnRlbnQ6IHNlYXJjaFF1ZXJ5XG4gICAgICAgIH1dLFxuICAgICAgICB0ZW1wZXJhdHVyZTogMC43LFxuICAgICAgICBtYXhfdG9rZW5zOiAyMDAwLFxuICAgICAgICBzdHJlYW06IGZhbHNlXG4gICAgICB9KVxuICAgIH0pO1xuXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgY29uc29sZS5sb2coJ0RlZXBTZWVrIEFQSeiwg+eUqOWksei0pe+8jOWwneivleWkh+eUqOaWueahiCcpO1xuICAgICAgcmV0dXJuIGF3YWl0IHNlYXJjaE9yaWdpbmFsVGV4dEZhbGxiYWNrKGJvb2tOYW1lLCBxdWVzdGlvbik7XG4gICAgfVxuXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICBcbiAgICBpZiAoZGF0YS5jaG9pY2VzICYmIGRhdGEuY2hvaWNlcy5sZW5ndGggPiAwICYmIGRhdGEuY2hvaWNlc1swXS5tZXNzYWdlLmNvbnRlbnQgJiYgZGF0YS5jaG9pY2VzWzBdLm1lc3NhZ2UuY29udGVudC5sZW5ndGggPiAxMCkge1xuICAgICAgY29uc3QgY29udGVudCA9IGRhdGEuY2hvaWNlc1swXS5tZXNzYWdlLmNvbnRlbnQ7XG4gICAgICAvLyDmj5Dlj5bljp/mloflhoXlrrlcbiAgICAgIGNvbnN0IG9yaWdpbmFsVGV4dCA9IGV4dHJhY3RPcmlnaW5hbFRleHQoY29udGVudCwgYm9va05hbWUpO1xuICAgICAgXG4gICAgICBpZiAob3JpZ2luYWxUZXh0ICYmIG9yaWdpbmFsVGV4dC5sZW5ndGggPiAxMCkge1xuICAgICAgICByZXR1cm4gb3JpZ2luYWxUZXh0O1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIOWmguaenEFQSee7k+aenOS4jeeQhuaDs++8jOS9v+eUqOWkh+eUqOaWueahiFxuICAgIHJldHVybiBhd2FpdCBzZWFyY2hPcmlnaW5hbFRleHRGYWxsYmFjayhib29rTmFtZSwgcXVlc3Rpb24pO1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignQUnmkJzntKLljp/mloflpLHotKU6JywgZXJyb3IpO1xuICAgIHJldHVybiBhd2FpdCBzZWFyY2hPcmlnaW5hbFRleHRGYWxsYmFjayhib29rTmFtZSwgcXVlc3Rpb24pO1xuICB9XG59XG5cbi8vIOWkh+eUqOaWueahiO+8muS7juaVsOaNruW6k+WGheWuueS4reaQnOe0ouWOn+aWh1xuYXN5bmMgZnVuY3Rpb24gc2VhcmNoT3JpZ2luYWxUZXh0RmFsbGJhY2soYm9va05hbWUsIHF1ZXN0aW9uKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBkYXRhOiBib29rcywgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnYm9va19saWJyYXJ5JylcbiAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgLmVxKCdib29rX25hbWUnLCBib29rTmFtZSlcbiAgICAgIC5saW1pdCgxKTtcblxuICAgIGlmIChlcnJvciB8fCAhYm9va3MgfHwgYm9va3MubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBib29rID0gYm9va3NbMF07XG4gICAgaWYgKCFib29rLmNoYXB0ZXJfY29udGVudCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLy8g5LuO56ug6IqC5YaF5a655Lit5o+Q5Y+W55u45YWz5Y+l5a2QXG4gICAgY29uc3Qgc2VudGVuY2VzID0gZXh0cmFjdFJlbGV2YW50U2VudGVuY2VzKGJvb2suY2hhcHRlcl9jb250ZW50LCBxdWVzdGlvbik7XG4gICAgaWYgKHNlbnRlbmNlcy5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gc2VudGVuY2VzLnNsaWNlKDAsIDMpLmpvaW4oJ++8jCcpO1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+Wkh+eUqOaQnOe0ouWksei0pTonLCBlcnJvcik7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLy8g55SoQUnmkJzntKLnq6DoioLlkI3np7BcbmFzeW5jIGZ1bmN0aW9uIHNlYXJjaENoYXB0ZXJOYW1lV2l0aEFJKGJvb2tOYW1lLCBvcmlnaW5hbFRleHQpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzZWFyY2hRdWVyeSA9IGDov5nmrrXljp/mlodcIiR7b3JpZ2luYWxUZXh0fVwi5Ye66Ieq44CKJHtib29rTmFtZX3jgIvnmoTlk6rkuKrnq6DoioLvvJ/or7flj6rov5Tlm57nq6DoioLlkI3np7DvvIzkuI3opoHlhbbku5bop6Pph4pgO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKCdBSeaQnOe0oueroOiKguWQjeafpeivojonLCBzZWFyY2hRdWVyeSk7XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCdodHRwczovL2FwaS5kZWVwc2Vlay5jb20vY2hhdC9jb21wbGV0aW9ucycsIHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAnQXV0aG9yaXphdGlvbic6ICdCZWFyZXIgc2stM2RkNTMyOGRiOWQ0NGQ5Y2I0ZTZlN2RmMDJlZTRiMmQnXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBtb2RlbDogJ2RlZXBzZWVrLWNoYXQnLFxuICAgICAgICBtZXNzYWdlczogW3tcbiAgICAgICAgICByb2xlOiAndXNlcicsXG4gICAgICAgICAgY29udGVudDogc2VhcmNoUXVlcnlcbiAgICAgICAgfV0sXG4gICAgICAgIHRlbXBlcmF0dXJlOiAwLjcsXG4gICAgICAgIG1heF90b2tlbnM6IDIwMDAsXG4gICAgICAgIHN0cmVhbTogZmFsc2VcbiAgICAgIH0pXG4gICAgfSk7XG5cbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICByZXR1cm4gYXdhaXQgc2VhcmNoQ2hhcHRlck5hbWVGYWxsYmFjayhib29rTmFtZSwgb3JpZ2luYWxUZXh0KTtcbiAgICB9XG5cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgIFxuICAgIGlmIChkYXRhLmNob2ljZXMgJiYgZGF0YS5jaG9pY2VzLmxlbmd0aCA+IDAgJiYgZGF0YS5jaG9pY2VzWzBdLm1lc3NhZ2UuY29udGVudCkge1xuICAgICAgY29uc3QgY2hhcHRlck5hbWUgPSBleHRyYWN0Q2hhcHRlck5hbWUoZGF0YS5jaG9pY2VzWzBdLm1lc3NhZ2UuY29udGVudCk7XG4gICAgICBpZiAoY2hhcHRlck5hbWUpIHtcbiAgICAgICAgcmV0dXJuIGNoYXB0ZXJOYW1lO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBhd2FpdCBzZWFyY2hDaGFwdGVyTmFtZUZhbGxiYWNrKGJvb2tOYW1lLCBvcmlnaW5hbFRleHQpO1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignQUnmkJzntKLnq6DoioLlkI3lpLHotKU6JywgZXJyb3IpO1xuICAgIHJldHVybiBhd2FpdCBzZWFyY2hDaGFwdGVyTmFtZUZhbGxiYWNrKGJvb2tOYW1lLCBvcmlnaW5hbFRleHQpO1xuICB9XG59XG5cbi8vIOWkh+eUqOaWueahiO+8muS7juaVsOaNruW6k+iOt+WPlueroOiKguWQjVxuYXN5bmMgZnVuY3Rpb24gc2VhcmNoQ2hhcHRlck5hbWVGYWxsYmFjayhib29rTmFtZSwgb3JpZ2luYWxUZXh0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBkYXRhOiBib29rcywgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnYm9va19saWJyYXJ5JylcbiAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgLmVxKCdib29rX25hbWUnLCBib29rTmFtZSk7XG5cbiAgICBpZiAoZXJyb3IgfHwgIWJvb2tzIHx8IGJvb2tzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuICfnu4/lhbjnr4fnq6AnO1xuICAgIH1cblxuICAgIC8vIOWwneivleWcqOeroOiKguWGheWuueS4reaJvuWIsOWMuemFjeeahOWOn+aWh1xuICAgIGZvciAoY29uc3QgYm9vayBvZiBib29rcykge1xuICAgICAgaWYgKGJvb2suY2hhcHRlcl9jb250ZW50ICYmIGJvb2suY2hhcHRlcl9jb250ZW50LmluY2x1ZGVzKG9yaWdpbmFsVGV4dC5zdWJzdHJpbmcoMCwgMTApKSkge1xuICAgICAgICByZXR1cm4gYm9vay5jaGFwdGVyX25hbWUgfHwgJ+e7j+WFuOevh+eroCc7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8g5aaC5p6c5rKh5om+5Yiw5Yy56YWN77yM6L+U5Zue56ys5LiA5Liq56ug6IqC5ZCNXG4gICAgcmV0dXJuIGJvb2tzWzBdLmNoYXB0ZXJfbmFtZSB8fCAn57uP5YW456+H56ugJztcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCflpIfnlKjnq6DoioLlkI3mkJzntKLlpLHotKU6JywgZXJyb3IpO1xuICAgIHJldHVybiAn57uP5YW456+H56ugJztcbiAgfVxufVxuXG4vLyDku47mkJzntKLnu5PmnpzkuK3mj5Dlj5bljp/mlodcbmZ1bmN0aW9uIGV4dHJhY3RPcmlnaW5hbFRleHQoY29udGVudCwgYm9va05hbWUpIHtcbiAgaWYgKCFjb250ZW50KSByZXR1cm4gbnVsbDtcbiAgXG4gIC8vIOenu+mZpEhUTUzmoIfnrb7lkozlpJrkvZnnqbrnmb1cbiAgbGV0IHRleHQgPSBjb250ZW50LnJlcGxhY2UoLzxbXj5dKj4vZywgJycpLnRyaW0oKTtcbiAgXG4gIC8vIOenu+mZpOaVsOWtl+W6j+WPt++8iOWmglwiMS4gXCLjgIFcIjIuIFwi562J77yJXG4gIHRleHQgPSB0ZXh0LnJlcGxhY2UoL15cXGQrXFwuXFxzKi9nbSwgJycpO1xuICBcbiAgLy8g56e76Zmk6Kej6YeK5oCn5paH5a2X5ZKM5ous5Y+35YaF5a65XG4gIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xcKFteKV0qXFwpL2csICcnKS5yZXBsYWNlKC/vvIhbXu+8iV0q77yJL2csICcnKTtcbiAgdGV4dCA9IHRleHQucmVwbGFjZSgv5q2k5Y+lW17jgIJdKuOAgj8vZywgJycpLnJlcGxhY2UoL+i/meWPpeivnVte44CCXSrjgII/L2csICcnKTtcbiAgdGV4dCA9IHRleHQucmVwbGFjZSgv5Ye66IeqW17jgIJdKuOAgj8vZywgJycpLnJlcGxhY2UoL+adpea6kFte44CCXSrjgII/L2csICcnKTtcbiAgXG4gIC8vIOenu+mZpOS5puWQjeS/oeaBr++8jOmBv+WFjeWcqHNvdXJjZeS4remHjeWkjeaYvuekuuS5puWQjVxuICBpZiAoYm9va05hbWUpIHtcbiAgICBjb25zdCBib29rTmFtZVJlZ2V4ID0gbmV3IFJlZ0V4cChg44CKPyR7Ym9va05hbWUucmVwbGFjZSgvWy4qKz9eJHt9KCl8W1xcXVxcXFxdL2csICdcXFxcJCYnKX3jgIs/W8K3XFxzXSpgLCAnZ2knKTtcbiAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKGJvb2tOYW1lUmVnZXgsICcnKTtcbiAgfVxuICBcbiAgLy8g56e76Zmk56ug6IqC5ZCN5YmN57yA77yI5aaCXCLlnqbku6TjgIvvvJpcIuOAgVwi5YW15rOV44CL77yaXCLnrYnvvIlcbiAgdGV4dCA9IHRleHQucmVwbGFjZSgvLio/44CL77yaXCIvZywgJycpO1xuICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC8uKj/jgJHvvJpcIi9nLCAnJyk7XG4gIHRleHQgPSB0ZXh0LnJlcGxhY2UoLy4qP+OAie+8mlwiL2csICcnKTtcbiAgdGV4dCA9IHRleHQucmVwbGFjZSgvLio/44CL77yaL2csICcnKTtcbiAgdGV4dCA9IHRleHQucmVwbGFjZSgvLio/44CR77yaL2csICcnKTtcbiAgdGV4dCA9IHRleHQucmVwbGFjZSgvLio/44CJ77yaL2csICcnKTtcbiAgXG4gIC8vIOenu+mZpOWFtuS7luW4uOingeeahOeroOiKguagh+ivhuespuWSjOW8leWPt1xuICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9eW17vvJpdKu+8mi9nbSwgJycpO1xuICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9eXCIvZywgJycpLnJlcGxhY2UoL1wiJC9nLCAnJyk7XG4gIHRleHQgPSB0ZXh0LnJlcGxhY2UoL14nL2csICcnKS5yZXBsYWNlKC8nJC9nLCAnJyk7XG4gIFxuICAvLyDmn6Xmib7nuq/lh4DnmoTlj6Tmloflj6XlrZBcbiAgY29uc3Qgc2VudGVuY2VzID0gdGV4dC5zcGxpdCgvW+OAgu+8ge+8n++8m10vKS5maWx0ZXIocyA9PiBzLmxlbmd0aCA+IDUgJiYgcy5sZW5ndGggPCA1MCk7XG4gIFxuICBmb3IgKGNvbnN0IHNlbnRlbmNlIG9mIHNlbnRlbmNlcykge1xuICAgIGNvbnN0IGNsZWFuU2VudGVuY2UgPSBzZW50ZW5jZS50cmltKCk7XG4gICAgLy8g5LyY5YWI6YCJ5oup5Y+k5YW45paH5pys6aOO5qC855qE5Y+l5a2QXG4gICAgaWYgKGlzQ2xhc3NpY2FsVGV4dChjbGVhblNlbnRlbmNlKSAmJiAhY2xlYW5TZW50ZW5jZS5pbmNsdWRlcygn44CKJykgJiYgIWNsZWFuU2VudGVuY2UuaW5jbHVkZXMoJ+evhycpKSB7XG4gICAgICByZXR1cm4gY2xlYW5TZW50ZW5jZTtcbiAgICB9XG4gIH1cbiAgXG4gIC8vIOWmguaenOayoeaJvuWIsOWPpOWFuOWPpeWtkO+8jOi/lOWbnuesrOS4gOS4quWQiOmAgumVv+W6pueahOWPpeWtkFxuICBmb3IgKGNvbnN0IHNlbnRlbmNlIG9mIHNlbnRlbmNlcykge1xuICAgIGNvbnN0IGNsZWFuU2VudGVuY2UgPSBzZW50ZW5jZS50cmltKCk7XG4gICAgaWYgKGNsZWFuU2VudGVuY2UubGVuZ3RoID49IDEwICYmIGNsZWFuU2VudGVuY2UubGVuZ3RoIDw9IDMwICYmICFjbGVhblNlbnRlbmNlLmluY2x1ZGVzKCfjgIonKSkge1xuICAgICAgcmV0dXJuIGNsZWFuU2VudGVuY2U7XG4gICAgfVxuICB9XG4gIFxuICAvLyDmnIDlkI7lpIfpgInvvJrov5Tlm57nrKzkuIDlj6VcbiAgcmV0dXJuIHNlbnRlbmNlcy5sZW5ndGggPiAwID8gc2VudGVuY2VzWzBdLnRyaW0oKSA6IG51bGw7XG59XG5cbi8vIOS7jueroOiKguWQjeaQnOe0oue7k+aenOS4reaPkOWPlueroOiKguWQjVxuZnVuY3Rpb24gZXh0cmFjdENoYXB0ZXJOYW1lKGNvbnRlbnQpIHtcbiAgaWYgKCFjb250ZW50KSByZXR1cm4gbnVsbDtcbiAgXG4gIGNvbnN0IHRleHQgPSBjb250ZW50LnJlcGxhY2UoLzxbXj5dKj4vZywgJycpLnRyaW0oKTtcbiAgXG4gIC8vIOW4uOingeeahOeroOiKguWQjeaooeW8j1xuICBjb25zdCBwYXR0ZXJucyA9IFtcbiAgICAv56ysW+S4gOS6jOS4ieWbm+S6lOWFreS4g+WFq+S5neWNgVxcZF0r56ugW++8mjpdPyhbXu+8jOOAgu+8ge+8n++8m10rKS8sXG4gICAgL+esrFvkuIDkuozkuInlm5vkupTlha3kuIPlhavkuZ3ljYFcXGRdK+evh1vvvJo6XT8oW17vvIzjgILvvIHvvJ/vvJtdKykvLFxuICAgIC8oW17vvIzjgILvvIHvvJ/vvJtdezIsMTB9KVvnq6Dnr4ddLyxcbiAgICAv44CKW17jgItdK+OAiyhbXu+8jOOAgu+8ge+8n++8m117MiwxNX0pL1xuICBdO1xuICBcbiAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIHBhdHRlcm5zKSB7XG4gICAgY29uc3QgbWF0Y2ggPSB0ZXh0Lm1hdGNoKHBhdHRlcm4pO1xuICAgIGlmIChtYXRjaCkge1xuICAgICAgcmV0dXJuIG1hdGNoWzFdID8gbWF0Y2hbMV0udHJpbSgpIDogbWF0Y2hbMF0udHJpbSgpO1xuICAgIH1cbiAgfVxuICBcbiAgLy8g5aaC5p6c5rKh5pyJ5Yy56YWN5Yiw5qih5byP77yM5bCd6K+V5o+Q5Y+W55+t6K+tXG4gIGNvbnN0IHdvcmRzID0gdGV4dC5zcGxpdCgvW++8jOOAgu+8ge+8n++8m1xcc10rLykuZmlsdGVyKHcgPT4gdy5sZW5ndGggPj0gMiAmJiB3Lmxlbmd0aCA8PSA4KTtcbiAgaWYgKHdvcmRzLmxlbmd0aCA+IDApIHtcbiAgICByZXR1cm4gd29yZHNbMF07XG4gIH1cbiAgXG4gIHJldHVybiBudWxsO1xufVxuXG4vLyDku47nq6DoioLlhoXlrrnkuK3mj5Dlj5bnm7jlhbPlj6XlrZBcbmZ1bmN0aW9uIGV4dHJhY3RSZWxldmFudFNlbnRlbmNlcyhjb250ZW50LCBxdWVzdGlvbikge1xuICBpZiAoIWNvbnRlbnQpIHJldHVybiBbXTtcbiAgXG4gIGNvbnN0IHNlbnRlbmNlcyA9IGNvbnRlbnQuc3BsaXQoL1vjgILvvIHvvJ/vvJtdLykuZmlsdGVyKHMgPT4gcy5sZW5ndGggPiA1KTtcbiAgY29uc3QgcXVlc3Rpb25LZXl3b3JkcyA9IGV4dHJhY3RLZXl3b3JkcyhxdWVzdGlvbik7XG4gIFxuICBjb25zdCByZWxldmFudFNlbnRlbmNlcyA9IHNlbnRlbmNlcy5maWx0ZXIoc2VudGVuY2UgPT4ge1xuICAgIHJldHVybiBxdWVzdGlvbktleXdvcmRzLnNvbWUoa2V5d29yZCA9PiBzZW50ZW5jZS5pbmNsdWRlcyhrZXl3b3JkKSk7XG4gIH0pLnNsaWNlKDAsIDMpO1xuICBcbiAgcmV0dXJuIHJlbGV2YW50U2VudGVuY2VzLmxlbmd0aCA+IDAgPyByZWxldmFudFNlbnRlbmNlcyA6IHNlbnRlbmNlcy5zbGljZSgwLCAyKTtcbn1cblxuLy8g5o+Q5Y+W6Zeu6aKY5YWz6ZSu6K+NXG5mdW5jdGlvbiBleHRyYWN0S2V5d29yZHMocXVlc3Rpb24pIHtcbiAgLy8g56e76Zmk5bi46KeB55qE55aR6Zeu6K+N5ZKM5Yqp6K+NXG4gIGNvbnN0IHN0b3BXb3JkcyA9IFsn5aaC5L2VJywgJ+aAjuS5iCcsICfku4DkuYgnLCAn5Li65LuA5LmIJywgJ+WTquS4qicsICflk6rkupsnLCAn5bqU6K+lJywgJ+WPr+S7pScsICfog73lpJ8nLCAn55qEJywgJ+S6hicsICflkJcnLCAn5ZGiJywgJ+WQpyddO1xuICBjb25zdCB3b3JkcyA9IHF1ZXN0aW9uLnNwbGl0KC9bXFxz77yM44CC77yB77yf77ybXSsvKS5maWx0ZXIod29yZCA9PiBcbiAgICB3b3JkLmxlbmd0aCA+PSAyICYmICFzdG9wV29yZHMuaW5jbHVkZXMod29yZClcbiAgKTtcbiAgcmV0dXJuIHdvcmRzO1xufVxuXG4vLyDliKTmlq3mmK/lkKbkuLrlj6TlhbjmlofmnKxcbmZ1bmN0aW9uIGlzQ2xhc3NpY2FsVGV4dCh0ZXh0KSB7XG4gIGNvbnN0IGNsYXNzaWNhbFBhdHRlcm5zID0gW1xuICAgIC9b5LmL5LmO6ICF5Lmf55+j54SJXS8sXG4gICAgL1vlkJvlrZDlsI/kurpdLyxcbiAgICAvW+WkqeS4i+WbveWutl0vLFxuICAgIC9b6YGT5b635LuB5LmJXS8sXG4gICAgL1vmmbrli4fku4FdL1xuICBdO1xuICBcbiAgcmV0dXJuIGNsYXNzaWNhbFBhdHRlcm5zLnNvbWUocGF0dGVybiA9PiBwYXR0ZXJuLnRlc3QodGV4dCkpO1xufSJdLCJuYW1lcyI6WyJzdXBhYmFzZSIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJxdWVzdGlvbiIsInN0cmF0ZWd5X2NhdGVnb3J5IiwiYm9keSIsImNvbnNvbGUiLCJsb2ciLCJzZWxlY3RlZEJvb2siLCJzZWxlY3RCb29rQnlTdHJhdGVneSIsImJvb2tfbmFtZSIsIm9yaWdpbmFsVGV4dCIsInNlYXJjaE9yaWdpbmFsVGV4dFdpdGhBSSIsInF1b3RlIiwiYm9va05hbWUiLCJjaGFwdGVyTmFtZSIsInNvdXJjZSIsImZyb21OZXR3b3JrU2VhcmNoIiwic2VhcmNoQ2hhcHRlck5hbWVXaXRoQUkiLCJzZWFyY2hRdWVyeSIsImRhdGEiLCJib29rcyIsImZyb20iLCJzZWxlY3QiLCJlcSIsImxlbmd0aCIsInJhbmRvbUluZGV4IiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwicmVzcG9uc2UiLCJmZXRjaCIsImhlYWRlcnMiLCJKU09OIiwic3RyaW5naWZ5IiwibW9kZWwiLCJtZXNzYWdlcyIsInJvbGUiLCJjb250ZW50IiwidGVtcGVyYXR1cmUiLCJtYXhfdG9rZW5zIiwic3RyZWFtIiwib2siLCJzZWFyY2hPcmlnaW5hbFRleHRGYWxsYmFjayIsImNob2ljZXMiLCJtZXNzYWdlIiwiZXh0cmFjdE9yaWdpbmFsVGV4dCIsImxpbWl0IiwiYm9vayIsImNoYXB0ZXJfY29udGVudCIsInNlbnRlbmNlcyIsImV4dHJhY3RSZWxldmFudFNlbnRlbmNlcyIsInNsaWNlIiwiam9pbiIsInNlYXJjaENoYXB0ZXJOYW1lRmFsbGJhY2siLCJleHRyYWN0Q2hhcHRlck5hbWUiLCJpbmNsdWRlcyIsInN1YnN0cmluZyIsImNoYXB0ZXJfbmFtZSIsInRleHQiLCJyZXBsYWNlIiwidHJpbSIsImJvb2tOYW1lUmVnZXgiLCJSZWdFeHAiLCJzcGxpdCIsImZpbHRlciIsInMiLCJzZW50ZW5jZSIsImNsZWFuU2VudGVuY2UiLCJpc0NsYXNzaWNhbFRleHQiLCJwYXR0ZXJucyIsInBhdHRlcm4iLCJtYXRjaCIsIndvcmRzIiwidyIsInF1ZXN0aW9uS2V5d29yZHMiLCJleHRyYWN0S2V5d29yZHMiLCJyZWxldmFudFNlbnRlbmNlcyIsInNvbWUiLCJrZXl3b3JkIiwic3RvcFdvcmRzIiwid29yZCIsImNsYXNzaWNhbFBhdHRlcm5zIiwidGVzdCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/search-quotes.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fsearch-quotes&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fsearch-quotes.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();