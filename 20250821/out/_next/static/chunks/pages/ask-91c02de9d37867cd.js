(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[721],{7699:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/ask",function(){return s(5146)}])},5981:function(e,t,s){"use strict";s.d(t,{Y:function(){return a},supabase:function(){return r}});let r=(0,s(1608).eI)("https://crnfwlpcxrnqfgwqnmun.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNybmZ3bHBjeHJucWZnd3FubXVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNTAzMDQsImV4cCI6MjA3MDcyNjMwNH0.g_HmFQQiuGW2TZRzZ5gqCj098DZy6iwn_xQAE6kEUEI"),a={supabase:r,async insert(e,t){let{data:s,error:a}=await r.from(e).insert(t).select();if(a)throw console.error("插入数据错误:",a),a;return s},async select(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=r.from(e).select("*");Object.entries(t).forEach(e=>{let[t,r]=e;s=s.eq(t,r)});let{data:a,error:n}=await s;if(n)throw console.error("查询数据错误:",n),n;return a},async update(e,t,s){let{data:a,error:n}=await r.from(e).update(s).eq("id",t).select();if(n)throw console.error("更新数据错误:",n),n;return a},async delete(e,t){let{error:s}=await r.from(e).delete().eq("id",t);if(s)throw console.error("删除数据错误:",s),s;return!0},async testConnection(){try{let{data:e,error:t}=await r.rpc("version");if(t){let{error:e}=await r.from("test_connection_table").select("*").limit(1);if(e&&("PGRST116"===e.code||"42P01"===e.code))return console.log("数据库连接成功!"),!0;return console.error("数据库连接测试失败:",e||t),!1}return console.log("数据库连接成功!"),!0}catch(e){return console.error("连接测试异常:",e),!1}}}},5146:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return l}});var r=s(5893),a=s(7294),n=s(8339),i=s.n(n),o=s(5981);function l(){let[e,t]=(0,a.useState)(""),[n,l]=(0,a.useState)(!1),[c,_]=(0,a.useState)(""),[d,u]=(0,a.useState)("未连接"),[h,m]=(0,a.useState)([]),[b,k]=(0,a.useState)([]);(0,a.useEffect)(()=>{let e=async()=>{try{let{supabase:e}=await Promise.resolve().then(s.bind(s,5981)),{data:t,error:r}=await e.from("book_library").select("strategy_category").order("strategy_category");if(r)console.error("获取策略分类失败:",r),k([{id:"行正持礼",label:"行正持礼"},{id:"顺势而为",label:"顺势而为"},{id:"巧谋实战",label:"巧谋实战"},{id:"运筹帷幄",label:"运筹帷幄"}]);else{let e=[...new Set(t.map(e=>e.strategy_category))].map(e=>({id:e,label:e}));k(e)}}catch(e){console.error("获取策略分类失败:",e),k([{id:"行正持礼",label:"行正持礼"},{id:"顺势而为",label:"顺势而为"},{id:"巧谋实战",label:"巧谋实战"},{id:"运筹帷幄",label:"运筹帷幄"}])}};(async()=>{try{let e=await o.Y.testConnection();u(e?"已连接":"连接失败")}catch(e){u("连接错误"),console.error("数据库连接测试失败:",e)}})(),e()},[]);let f=e=>{m(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},g=async t=>{if(t.preventDefault(),e.trim()){l(!0);try{let t=h.length>0?h.join(","):"",s=new URLSearchParams({question:e,...t&&{strategies:t}});window.location.href="/answer?".concat(s.toString())}catch(e){console.error("提交失败:",e),l(!1)}}};return(0,r.jsxs)("div",{className:i().container,children:[(0,r.jsxs)("nav",{className:i().navbar,children:[(0,r.jsx)("div",{className:i().brand,onClick:()=>window.location.href="/",style:{cursor:"pointer"},children:"方略 Fanglue"}),(0,r.jsx)("div",{className:i().navLinks,children:(0,r.jsx)("button",{className:i().authBtn,children:"注册/登录"})})]}),(0,r.jsxs)("main",{className:i().mainContent,children:[(0,r.jsxs)("div",{className:i().header,children:[(0,r.jsx)("h1",{className:i().title,children:"问古今，寻方略"}),(0,r.jsx)("p",{className:i().subtitle,children:"让千载经略，为你今日一策"})]}),(0,r.jsxs)("form",{onSubmit:g,className:i().questionForm,children:[(0,r.jsx)("div",{className:i().inputGroup,children:(0,r.jsx)("textarea",{value:e,onChange:e=>t(e.target.value),placeholder:"请输入您的问题...",className:i().questionInput,rows:6,disabled:n})}),(0,r.jsxs)("div",{className:i().strategySection,children:[(0,r.jsx)("h3",{className:i().strategyTitle,children:"方略经纬"}),(0,r.jsx)("p",{className:i().strategySubtitle,children:"您希望从哪些方面获得解答？（可单选或多选，如果不选，将自动为您搜索最优策略）"}),(0,r.jsx)("div",{className:i().strategyGrid,children:b.map(e=>(0,r.jsx)("div",{className:"".concat(i().strategyOption," ").concat(h.includes(e.id)?i().selected:""),onClick:()=>f(e.id),children:(0,r.jsxs)("div",{className:i().strategyCheckbox,children:[(0,r.jsx)("input",{type:"checkbox",id:e.id,checked:h.includes(e.id),onChange:()=>f(e.id),className:i().checkbox}),(0,r.jsx)("label",{htmlFor:e.id,className:i().checkboxLabel,children:(0,r.jsx)("div",{className:i().strategyLabel,children:e.label})})]})},e.id))})]}),(0,r.jsx)("button",{type:"submit",className:"".concat(i().submitButton," ").concat(n?i().loading:""),disabled:!e.trim()||n,children:n?"处理中...":"立即寻索"})]}),c&&(0,r.jsxs)("div",{className:i().answerSection,children:[(0,r.jsx)("h3",{className:i().answerTitle,children:"方略解答"}),(0,r.jsx)("div",{className:i().answerContent,children:c})]})]}),(0,r.jsxs)("footer",{className:i().footerSection,children:[(0,r.jsx)("div",{className:i().footerTitle,children:"让千载经略，为你今日一策"}),(0,r.jsxs)("div",{className:i().footerButtons,children:[(0,r.jsx)("a",{href:"#",className:i().footerBtn,title:"功能开发中，敬请期待",children:"众议百解"}),(0,r.jsx)("a",{href:"#",className:i().footerBtn,title:"功能开发中，敬请期待",children:"一日一策"}),(0,r.jsx)("a",{href:"#",className:i().footerBtn,title:"功能开发中，敬请期待",children:"历问历答"})]})]})]})}},8339:function(e){e.exports={container:"Ask_container__K8Er4",navbar:"Ask_navbar__nZK1Y",brand:"Ask_brand__kNLBD",navLinks:"Ask_navLinks__dRjsn",authBtn:"Ask_authBtn__l2xrS",mainContent:"Ask_mainContent__AMGTl",header:"Ask_header__PTw99",title:"Ask_title__omFmW",subtitle:"Ask_subtitle__hitrC",questionForm:"Ask_questionForm__WUnSJ",inputGroup:"Ask_inputGroup__epmN7",questionInput:"Ask_questionInput__oIowT",strategySection:"Ask_strategySection__bOqWF",strategyTitle:"Ask_strategyTitle__V9Cn_",strategySubtitle:"Ask_strategySubtitle__K2DYa",strategyGrid:"Ask_strategyGrid__CqRp9",strategyOption:"Ask_strategyOption__bkvtG",selected:"Ask_selected__7JCMj",strategyCheckbox:"Ask_strategyCheckbox__tr7B_",checkbox:"Ask_checkbox__hl8gQ",checkboxLabel:"Ask_checkboxLabel__64Jur",strategyLabel:"Ask_strategyLabel__J_FWp",submitButton:"Ask_submitButton__tig4h",loading:"Ask_loading___q74m",progressBar:"Ask_progressBar__2yGF1",progressFill:"Ask_progressFill__fkxfB",progressText:"Ask_progressText__Os8pk",footerSection:"Ask_footerSection__EN4Qi",footerTitle:"Ask_footerTitle__e76h_",footerButtons:"Ask_footerButtons__JX7La",footerBtn:"Ask_footerBtn__luBWq"}}},function(e){e.O(0,[608,774,888,179],function(){return e(e.s=7699)}),_N_E=e.O()}]);